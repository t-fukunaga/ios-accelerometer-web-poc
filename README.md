# 📱 加速度センサー デモ Web PoC

iOSデバイスの加速度センサーを使った2つのデモを体験できるWebアプリケーションです。

## 🚀 デモサイト

**https://t-fukunaga.github.io/ios-accelerometer-web-poc/**

iPhoneのSafariで上記URLにアクセスして、すぐにデモを体験できます！

## ✨ 特徴

### 🔄 傾きセンサーモード
- 🎨 3Dデバイス表示 - デバイスの傾きをリアルタイムで視覚化
- 💧 水平器風バブル - 傾きの方向を直感的に表示
- 📊 プログレスバー - 各軸の値を色分けして表示

### 🪄 ダウジングモード
- 🔍 ダウジングロッド - 動きに反応して角度が変化
- 📈 探知メーター - 加速度の変化量を視覚化
- ⚡ リアルタイム反応 - 4段階の探知レベル表示

### 🔧 共通機能
- タブ切り替えで2つのモードを使い分け
- デバッグ機能 - 必要に応じてログを表示
- 📱 iOS Safari 13以降対応

## 🚀 使い方

### オンラインデモ（推奨）
上記のデモサイトURLにiPhoneのSafariでアクセスするだけ！

### ローカル開発

#### ngrokを使った起動
```bash
# HTTPサーバーを起動
npm run dev

# 別のターミナルでngrok起動
ngrok http 8080
```

#### 直接HTTPサーバー起動
```bash
npm run dev
```

## 📱 iPhoneでの動作確認

1. **デモサイト**または**ngrokのHTTPS URL**にiPhoneのSafariでアクセス
2. 「センサーを開始」ボタンをタップ
3. 権限要求ダイアログが表示されたら「許可」をタップ
4. タブを切り替えて各モードを体験：

### 🔄 傾きセンサーモード
デバイスを傾けると以下が連動して動きます：
- 📱 3Dスマホアイコンが回転
- 💧 バブルが傾きの方向に移動
- 📊 プログレスバーが変化

### 🪄 ダウジングモード
デバイスを動かすと以下が反応します：
- 🔍 ダウジングロッドが開閉
- 📈 探知メーターが上昇
- ⚡ 探知フィールドが点滅
- 📢 4段階のステータス表示

## 📖 モードごとの使い方

### 🪄 ダウジングモード

スマホを**地面と垂直に**持って、水平方向（前後左右）に揺らしてください。スマホの左右の揺れがペンデュラムの左右の振れに、スマホの前後（画面の奥と手前）の揺れがペンデュラムの奥行き方向の振れに対応します。

```
   [📱]
    |
    | (You)
   / \
--------- (Ground)
```

### 🔭 真上から見るモード

スマホを**地面と水平に**置いて、テーブルの上などで滑らすように動かして���ださい。スマホのXY平面（画面の平面）での動きが、そのままビューのXY平面の動きとして表示されます。

```
(Top View)

  +-----[📱]-----+
  |            |
-------------------- (Table/Ground)
```

## 🎯 表示内容


### 🔄 傾きセンサーモード
- **3Dデバイス** - スマホアイコンがデバイスの傾きに合わせて回転
- **傾きバブル** - 水平器のように傾きの方向を示すバブル
- **X軸（赤）** - 左右の傾き
- **Y軸（緑）** - 前後の傾き  
- **Z軸（青）** - 上下の動き

### 🪄 ダウジングモード
- **ダウジングロッド** - 加速度の変化に応じて角度が変化
- **探知メーター** - 0-100%で動きの激しさを表示
- **探知ステータス** - 4段階の反応レベル：
  - 🔹 何も検出されていません（0-10%）
  - 🟢 弱い反応を検出（10-30%）
  - 🟡 強い反応を検出！（30-70%）
  - 🔴 非常に強い反応！何かあります！（70-100%）

### 🔧 デバッグ機能
- 右上の🔧ボタンでデバッグログの表示/非表示を切り替え
- 環境情報、権限状況、エラー情報を確認可能

## ⚠️ トラブルシューティング

### センサーが反応しない場合

1. **HTTPS接続を確認**
   - ngrokは自動的にHTTPS化されます
   - iOS 13以降はHTTPS接続が必須

2. **権限設定を確認**
   - 設定 > Safari > プライバシーとセキュリティ > モーションとオリエンテーションのアクセス

3. **デバイスを動かす**
   - 静止状態では変化が見えにくい場合があります

4. **デバッグログを確認**
   - 🔧ボタンでログを表示してエラーを確認

## 🛠 技術的な詳細

### 基本仕様
- **フレームワーク**: なし（バニラJavaScript）
- **センサーAPI**: `DeviceMotionEvent`
- **権限管理**: `DeviceMotionEvent.requestPermission()` (iOS 13+)
- **更新頻度**: 100ms
- **対応ブラウザ**: iOS Safari 13以降

### 傾きセンサーモード
- `accelerationIncludingGravity` の X/Y/Z 値を直接使用
- 3D表示は CSS `transform: rotateX() rotateY()` で実現
- プログレスバーは値の正負に応じて左右に伸縮

### ダウジングモード  
- 1秒間の加速度変化量を計算してモーション検出
- 変化量 = √(ΔX² + ΔY² + ΔZ²) の累積値
- ダウジングロッドの角度は変化量に比例して調整
- 探知レベルは変化量×10で計算（最大100%）

## 📋 必要な環境

- iOS Safari 13以降
- HTTPS接続（ngrok経由推奨）
- Node.js（開発用サーバー起動のため）