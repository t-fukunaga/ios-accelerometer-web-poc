# ペンデュラムダウジング デザインドキュメント

## 概要
加速度センサーを使用したインタラクティブなペンデュラムダウジングのWebアプリケーション。デバイスの動きに応じて振り子が揺れ、ダウジングチャートの答えを指し示します。

## デザインのポイント

### 1. 視覚的な構造

#### ペンデュラムの構成要素
- **固定点（アンカー）**: 上部に配置された固定点。グレーのグラデーションで金属的な質感を表現
- **チェーン**: 細い1pxのラインで繊細さを演出。グラデーションで立体感を付与
- **振り子（ウェイト）**: アメジスト風の紫色グラデーション。神秘的な雰囲気を演出

#### 3D表現
- `perspective: 800px`で奥行き感を演出
- チャートは60度の角度で傾けて表示（`rotateX(60deg)`）
- 斜め上から見下ろす視点で、ユーザーが実際にペンデュラムを使っているような体験を提供

### 2. 物理的な動作

#### 高度な物理シミュレーション
```javascript
// 減衰振動モデル (F = -kx - cv)
const SPRING_CONSTANT = 0.02;  // 復元力係数 (k)
const BASE_DAMPING = 0.98;     // 基本減衰係数 (c)
```

##### 重力補正システム
- **ローパスフィルタによる重力分離**: 加速度センサーの値から重力成分を分離
- **線形加速度の抽出**: デバイスの実際の動きのみを検出
- **LPF_ALPHA = 0.8**: 滑らかな重力推定のための係数

##### 静止状態の検出と中心への収束
- **静止判定**: 角速度がMOVEMENT_THRESHOLD (0.05) 以下で15フレーム継続
- **中心への引力**: 静止状態で中心に向かう弱い力 (CENTER_PULL_FORCE = 0.005)
- **完全停止**: デバイスを水平に置くと確実にチャート中心に収束

##### 3軸の運動
- **X軸・Y軸**: メインの振り子運動（前後左右）
- **Z軸**: 捻り運動（回転）- 弱めの復元力で自然な動き

#### 感度による動的調整
- **減衰係数**: 感度が高いほど減衰が弱い（長く揺れる）
- **最大角度**: BASE_MAX_ANGLE (60°) + 感度による追加
- **復元力**: 高感度ほど弱く（大きく揺れやすい）
- **外力スケール**: 非線形調整で自然な反応

### 3. インタラクティブな要素

#### ダウジングチャート
- 5つのセグメント: YES, NO, MAYBE, LATER, UNKNOWN
- 振り子が指している方向のセグメントがハイライト表示
- ハイライト時はテキストが拡大し、色が変化

#### 視覚的フィードバック
- **探知レベルメーター**: 動きの大きさを視覚化
- **ステータス表示**: 
  - 動作中: "XXXを指しています"
  - 静止過程: "動きを検出中..."
  - 完全静止: "中心に収束しました"
- **影の動的表現**: 距離に応じてスケールと不透明度が変化

### 4. カラーパレット

- **メインカラー**: `#667eea`（紫青）- モダンで神秘的な印象
- **振り子**: `#9b59b6`〜`#5b2c6f`（紫のグラデーション）
- **背景**: 白〜薄い青紫のグラデーション
- **アクセント**: 探知レベルに応じて緑→オレンジ→赤へ変化

### 5. アニメーションとトランジション

#### 物理ベースアニメーション
- **60fps更新**: `setInterval`で滑らかな物理演算
- **慣性の表現**: 角速度による自然な減速
- **影の追従**: 三角関数で正確な位置計算

#### 装飾的アニメーション
- 振り子のきらめき効果（`@keyframes sparkle`）
- セグメントのパルス効果（`@keyframes segmentPulse`）

### 6. レスポンシブデザイン

- 最大幅500pxのコンテナで、モバイルデバイスに最適化
- タッチ操作に配慮したボタンサイズ（最小44px）
- ビューポート設定で拡大縮小を制限し、安定した表示を維持

### 7. ユーザビリティ

#### 感度調整
- スライダーで0.5倍〜25倍まで調整可能
- リアルタイムで値を表示
- 物理パラメータが動的に変化

#### デバッグモード
- 開発者向けの詳細情報表示
- 加速度センサーの生データを確認可能
- 重力分離の状態を監視可能

## 技術的な実装の特徴

### 1. 高度な物理シミュレーション
```javascript
// 運動方程式の実装
const restoringForce = -SPRING_CONSTANT * angle;
const totalForce = externalForce + restoringForce;
velocity = (velocity + totalForce * dt) * DAMPING;
angle += velocity * dt;
```

### 2. センサーデータ処理
```javascript
// ローパスフィルタで重力を分離
gravity = LPF_ALPHA * gravity + (1 - LPF_ALPHA) * acceleration;
linearAcceleration = acceleration - gravity;
```

### 3. パフォーマンス最適化
- センサー更新: 100ms間隔（10Hz）
- 物理演算: 16.67ms間隔（60fps）
- 独立した更新サイクルで滑らかな動作

### 4. クロスプラットフォーム対応
- iOS 13+の権限リクエストに対応
- Androidでも動作確認済み
- HTTPSでの配信が必須（センサーAPI使用のため）

## 物理モデルの詳細

### 減衰振動モデル
振り子の動きは以下の微分方程式で表現：
```
F = -kx - cv
```
- k: バネ定数（復元力）
- c: 減衰係数（空気抵抗など）
- x: 変位（角度）
- v: 速度（角速度）

### 重力補正
1. **問題**: 加速度センサーは重力を含む値を返す
2. **解決**: ローパスフィルタで低周波成分（重力）を分離
3. **結果**: デバイスの実際の動きのみを検出可能

### 静止状態の管理
1. **検出**: 角速度が閾値以下で一定時間継続
2. **収束**: 中心への弱い引力を追加
3. **完全停止**: 角度・速度を0にリセット

## 今後の拡張可能性

- 複数のチャートパターン（数字、アルファベットなど）
- 振り子のカスタマイズ（色、形状、材質感）
- 履歴記録機能（選ばれた答えの統計）
- サウンドエフェクトの追加（振り子の動きに合わせた音）
- ARモードの実装（カメラ映像に重ねて表示）
- 振動フィードバック（答えを指した時）