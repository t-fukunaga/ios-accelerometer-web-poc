<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Âä†ÈÄüÂ∫¶„Çª„É≥„Çµ„Éº „Éá„É¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
            font-weight: 600;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 25px;
            font-size: 14px;
        }

        /* „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„Éà„Ç∞„É´ */
        .debug-toggle {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.1);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .debug-toggle:hover {
            background: rgba(0,0,0,0.2);
        }

        .debug-info {
            display: none;
            background: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 12px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }

        .debug-info.active {
            display: block;
        }

        /* „Çø„Éñ„Ç∑„Çπ„ÉÜ„É† */
        .tabs {
            display: flex;
            margin-bottom: 25px;
            background: #f0f0f0;
            border-radius: 12px;
            padding: 4px;
        }

        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #666;
        }

        .tab.active {
            background: white;
            color: #333;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .tab:hover:not(.active) {
            background: rgba(255,255,255,0.5);
        }

        /* „Çø„Éñ„Ç≥„É≥„ÉÜ„É≥„ÉÑ */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* „Çπ„ÉÜ„Éº„Çø„Çπ */
        .status {
            text-align: center;
            padding: 12px;
            margin-bottom: 20px;
            border-radius: 10px;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .status.waiting {
            background: #e3f2fd;
            color: #1976d2;
        }

        .status.success {
            background: #e8f5e9;
            color: #388e3c;
        }

        .status.error {
            background: #ffebee;
            color: #d32f2f;
        }

        /* „Çπ„Çø„Éº„Éà„Éú„Çø„É≥ */
        .start-button {
            display: block;
            width: 100%;
            padding: 16px;
            font-size: 18px;
            font-weight: 600;
            color: white;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
        }

        .start-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .start-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* „Çª„É≥„Çµ„Éº„Éá„Éº„ÇøË°®Á§∫ */
        .sensor-data {
            display: none;
        }

        .sensor-data.active {
            display: block;
        }

        /* === „Çø„Éñ1: ÂÇæ„Åç„Çª„É≥„Çµ„Éº === */
        
        /* 3D„Éá„Éê„Ç§„ÇπË°®Á§∫ */
        .device-visualizer {
            margin: 30px auto;
            width: 200px;
            height: 200px;
            perspective: 800px;
        }

        .device-3d {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.1s ease-out;
        }

        .device-face {
            position: absolute;
            width: 120px;
            height: 180px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 2px solid rgba(255,255,255,0.8);
            border-radius: 15px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            color: rgba(255,255,255,0.9);
            box-shadow: 0 0 30px rgba(102, 126, 234, 0.5);
        }

        /* Ëª∏„Åî„Å®„ÅÆ„Éá„Éº„ÇøË°®Á§∫ */
        .axis-container {
            margin-bottom: 20px;
        }

        .axis-item {
            margin-bottom: 20px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .axis-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .axis-label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 18px;
        }

        .axis-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 16px;
        }

        .axis-x .axis-icon { background: #e74c3c; }
        .axis-y .axis-icon { background: #2ecc71; }
        .axis-z .axis-icon { background: #3498db; }

        .axis-value {
            font-size: 20px;
            font-weight: 700;
            font-variant-numeric: tabular-nums;
        }

        /* „Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº */
        .progress-container {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: currentColor;
            transition: width 0.1s ease-out;
            position: absolute;
            left: 50%;
            transform-origin: left center;
        }

        .axis-x .progress-bar { background: #e74c3c; }
        .axis-y .progress-bar { background: #2ecc71; }
        .axis-z .progress-bar { background: #3498db; }

        /* Ë™¨Êòé„ÉÜ„Ç≠„Çπ„Éà */
        .axis-description {
            font-size: 12px;
            color: #666;
            margin-top: 8px;
        }

        /* ÂÇæ„ÅçÊñπÂêë„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº */
        .tilt-indicator {
            margin: 20px auto;
            width: 150px;
            height: 150px;
            position: relative;
            background: #f0f0f0;
            border-radius: 50%;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
        }

        .tilt-bubble {
            position: absolute;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.5);
            transition: all 0.1s ease-out;
        }

        /* === „Çø„Éñ2: „ÉÄ„Ç¶„Ç∏„É≥„Ç∞ === */
        
        .dowsing-container {
            text-align: center;
        }

        .pendulum-container {
            margin: 20px auto;
            width: 350px;
            height: 350px;
            position: relative;
            perspective: 800px;
        }

        /* „ÉÄ„Ç¶„Ç∏„É≥„Ç∞„ÉÅ„É£„Éº„Éà */
        .dowsing-chart {
            position: absolute;
            width: 350px;
            height: 350px;
            left: 0;
            top: 0;
            transform: rotateX(60deg);
            transform-style: preserve-3d;
        }

        .chart-circle {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 4px solid #667eea;
            border-radius: 50%;
            background: radial-gradient(circle at center, 
                rgba(255, 255, 255, 0.95) 0%, 
                rgba(240, 243, 255, 0.9) 40%,
                rgba(230, 235, 255, 0.85) 100%);
            box-shadow: 
                0 10px 30px rgba(102, 126, 234, 0.2),
                inset 0 2px 10px rgba(102, 126, 234, 0.1);
        }

        .chart-segment {
            position: absolute;
            width: 50%;
            height: 50%;
            top: 50%;
            left: 50%;
            transform-origin: 0 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 20px;
            color: #4a5568;
            text-shadow: 
                0 1px 3px rgba(255,255,255,0.9),
                0 -1px 3px rgba(255,255,255,0.9);
        }

        .chart-segment:nth-child(1) {
            transform: rotate(0deg) translate(-50%, -50%);
        }

        .chart-segment:nth-child(2) {
            transform: rotate(72deg) translate(-50%, -50%);
        }

        .chart-segment:nth-child(3) {
            transform: rotate(144deg) translate(-50%, -50%);
        }

        .chart-segment:nth-child(4) {
            transform: rotate(216deg) translate(-50%, -50%);
        }

        .chart-segment:nth-child(5) {
            transform: rotate(288deg) translate(-50%, -50%);
        }

        .chart-segment span {
            transform: rotate(-60deg);
            display: block;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .chart-segment.highlight span {
            transform: rotate(-60deg) scale(1.2);
            color: #667eea;
            font-weight: 700;
        }

        /* „Éö„É≥„Éá„É•„É©„É† */
        .pendulum {
            position: absolute;
            left: 50%;
            top: 20%;
            transform: translateX(-50%);
            transform-style: preserve-3d;
            z-index: 10;
        }

        .pendulum-anchor {
            position: absolute;
            width: 10px;
            height: 10px;
            background: radial-gradient(circle, #666 0%, #444 100%);
            border-radius: 50%;
            left: 50%;
            top: 0;
            transform: translateX(-50%);
            z-index: 2;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .pendulum-chain {
            position: absolute;
            width: 1px;
            height: 180px;
            left: 50%;
            top: 5px;
            transform: translateX(-50%);
            transform-origin: top center;
            transform-style: preserve-3d;
            transition: transform 0.15s ease-out;
        }

        .pendulum-chain::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, 
                rgba(200,200,200,0.8) 0%, 
                rgba(150,150,150,0.9) 50%,
                rgba(100,100,100,1) 100%);
            box-shadow: 0 0 2px rgba(0,0,0,0.2);
        }

        .pendulum-weight {
            position: absolute;
            width: 40px;
            height: 50px;
            background: linear-gradient(145deg, 
                #9b59b6 0%, 
                #8e44ad 30%, 
                #6c3483 60%,
                #5b2c6f 100%);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            left: 50%;
            bottom: 0;
            transform: translateX(-50%);
            box-shadow: 
                0 8px 20px rgba(107, 52, 131, 0.4),
                inset 0 -3px 8px rgba(0,0,0,0.2),
                inset 0 2px 6px rgba(255,255,255,0.3);
        }

        .pendulum-weight::before {
            content: '';
            position: absolute;
            width: 15px;
            height: 15px;
            background: radial-gradient(circle at 30% 30%, 
                rgba(255,255,255,0.8) 0%, 
                rgba(255,255,255,0.4) 40%,
                transparent 70%);
            border-radius: 50%;
            top: 8px;
            left: 8px;
        }

        .pendulum-weight::after {
            content: '';
            position: absolute;
            width: 12px;
            height: 12px;
            background: radial-gradient(circle, 
                rgba(255,255,255,0) 0%,
                rgba(255,255,255,0.2) 50%,
                rgba(255,255,255,0) 100%);
            border-radius: 50%;
            bottom: 5px;
            right: 5px;
            animation: sparkle 2s infinite;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .pendulum-shadow {
            position: absolute;
            width: 60px;
            height: 30px;
            background: radial-gradient(ellipse at center, 
                rgba(0,0,0,0.4) 0%, 
                rgba(0,0,0,0.2) 40%,
                transparent 70%);
            top: 330px;
            left: 50%;
            transform: translateX(-50%) rotateX(90deg);
            transition: all 0.15s ease-out;
            filter: blur(2px);
        }

        @keyframes pulse {
            0%, 100% { 
                transform: translate(-50%, -50%) scale(1);
                opacity: 0.3;
            }
            50% { 
                transform: translate(-50%, -50%) scale(1.1);
                opacity: 0.6;
            }
        }

        /* „ÉÅ„É£„Éº„Éà„ÅÆ„Éè„Ç§„É©„Ç§„ÉàË°®Á§∫ */
        .chart-segment.highlight {
            background: radial-gradient(circle at center, 
                rgba(102, 126, 234, 0.3) 0%, 
                rgba(102, 126, 234, 0.1) 50%,
                transparent 70%);
            animation: segmentPulse 1s infinite;
        }

        @keyframes segmentPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .detection-meter {
            margin: 30px auto;
            width: 250px;
        }

        .meter-label {
            text-align: center;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .meter-container {
            background: #f0f0f0;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .meter-fill {
            height: 100%;
            background: linear-gradient(90deg, #2ecc71 0%, #f39c12 50%, #e74c3c 100%);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .meter-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
            font-weight: bold;
            color: #333;
        }

        .detection-status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
            text-align: center;
            transition: all 0.3s ease;
        }

        .detection-status.none {
            background: #f8f9fa;
            color: #666;
        }

        .detection-status.weak {
            background: #e8f5e9;
            color: #2ecc71;
        }

        .detection-status.strong {
            background: #fff3cd;
            color: #f39c12;
        }

        .detection-status.very-strong {
            background: #ffebee;
            color: #e74c3c;
            animation: glow 1s infinite alternate;
        }

        @keyframes glow {
            from { box-shadow: 0 0 10px rgba(231, 76, 60, 0.3); }
            to { box-shadow: 0 0 20px rgba(231, 76, 60, 0.6); }
        }

        .info {
            font-size: 13px;
            color: #666;
            text-align: center;
            margin-top: 20px;
            line-height: 1.6;
        }

        /* ÊÑüÂ∫¶Ë™øÊï¥„Çπ„É©„Ç§„ÉÄ„Éº */
        .sensitivity-control {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .sensitivity-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-weight: 600;
            font-size: 14px;
        }

        .sensitivity-value {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .sensitivity-slider {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: #e0e0e0;
            border-radius: 4px;
            outline: none;
            transition: all 0.3s ease;
        }

        .sensitivity-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
        }

        .sensitivity-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.5);
        }

        .sensitivity-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
            border: none;
        }

        .sensitivity-slider::-moz-range-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.5);
        }

        .sensitivity-description {
            font-size: 12px;
            color: #666;
            margin-top: 8px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <button id="debugToggle" class="debug-toggle" title="„Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±">
            üîß
        </button>

        <h1>üì± Âä†ÈÄüÂ∫¶„Çª„É≥„Çµ„Éº „Éá„É¢</h1>
        <p class="subtitle">„Çø„Éñ„ÇíÂàá„ÇäÊõø„Åà„Å¶Êßò„ÄÖ„Å™„Éá„É¢„Çí‰ΩìÈ®ì</p>
        
        <div id="debugInfo" class="debug-info">
            „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô...
        </div>

        <!-- „Çø„Éñ -->
        <div class="tabs">
            <button class="tab active" data-tab="tilt">üîÑ ÂÇæ„Åç„Çª„É≥„Çµ„Éº</button>
            <button class="tab" data-tab="dowsing">ü™Ñ „ÉÄ„Ç¶„Ç∏„É≥„Ç∞</button>
        </div>

        <div id="status" class="status waiting">
            ÈñãÂßã„Éú„Çø„É≥„Çí„Çø„ÉÉ„Éó„Åó„Å¶„Åè„Å†„Åï„ÅÑ
        </div>

        <button id="startButton" class="start-button">
            „Çª„É≥„Çµ„Éº„ÇíÈñãÂßã
        </button>

        <!-- ÊÑüÂ∫¶Ë™øÊï¥ -->
        <div class="sensitivity-control">
            <div class="sensitivity-label">
                <span>üéöÔ∏è ÊÑüÂ∫¶Ë™øÊï¥</span>
                <span class="sensitivity-value" id="sensitivityValue">x2.0</span>
            </div>
            <input type="range" class="sensitivity-slider" id="sensitivitySlider" 
                   min="0.5" max="25" step="0.1" value="2">
            <div class="sensitivity-description">
                ‰ΩéÊÑüÂ∫¶ ‚Üê ‚Üí È´òÊÑüÂ∫¶
            </div>
        </div>

        <!-- „Çø„Éñ1: ÂÇæ„Åç„Çª„É≥„Çµ„Éº -->
        <div id="tiltContent" class="tab-content active">
            <div id="sensorData" class="sensor-data">
                <!-- 3D„Éá„Éê„Ç§„ÇπË°®Á§∫ -->
                <div class="device-visualizer">
                    <div id="device3d" class="device-3d">
                        <div class="device-face">üì±</div>
                    </div>
                </div>

                <!-- ÂÇæ„Åç„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº -->
                <div class="tilt-indicator">
                    <div id="tiltBubble" class="tilt-bubble"></div>
                </div>

                <!-- ÂêÑËª∏„ÅÆ„Éá„Éº„Çø -->
                <div class="axis-container">
                    <div class="axis-item axis-x">
                        <div class="axis-header">
                            <div class="axis-label">
                                <div class="axis-icon">X</div>
                                <span>Â∑¶Âè≥„ÅÆÂÇæ„Åç</span>
                            </div>
                            <div class="axis-value" id="xValue">0.00</div>
                        </div>
                        <div class="progress-container">
                            <div id="xProgress" class="progress-bar"></div>
                        </div>
                        <div class="axis-description">Â∑¶„Å´ÂÇæ„Åë„Çã ‚Üê ‚Üí Âè≥„Å´ÂÇæ„Åë„Çã</div>
                    </div>

                    <div class="axis-item axis-y">
                        <div class="axis-header">
                            <div class="axis-label">
                                <div class="axis-icon">Y</div>
                                <span>ÂâçÂæå„ÅÆÂÇæ„Åç</span>
                            </div>
                            <div class="axis-value" id="yValue">0.00</div>
                        </div>
                        <div class="progress-container">
                            <div id="yProgress" class="progress-bar"></div>
                        </div>
                        <div class="axis-description">ÊâãÂâç„Å´ÂÇæ„Åë„Çã ‚Üê ‚Üí Â••„Å´ÂÇæ„Åë„Çã</div>
                    </div>

                    <div class="axis-item axis-z">
                        <div class="axis-header">
                            <div class="axis-label">
                                <div class="axis-icon">Z</div>
                                <span>‰∏ä‰∏ã„ÅÆÂãï„Åç</span>
                            </div>
                            <div class="axis-value" id="zValue">0.00</div>
                        </div>
                        <div class="progress-container">
                            <div id="zProgress" class="progress-bar"></div>
                        </div>
                        <div class="axis-description">‰∏ãÂêë„Åç ‚Üê ‚Üí ‰∏äÂêë„Åç</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- „Çø„Éñ2: „ÉÄ„Ç¶„Ç∏„É≥„Ç∞ -->
        <div id="dowsingContent" class="tab-content">
            <div id="dowsingData" class="sensor-data dowsing-container">
                <div class="pendulum-container">
                    <div class="dowsing-chart">
                        <div class="chart-circle">
                            <div class="chart-segment"><span>YES</span></div>
                            <div class="chart-segment"><span>NO</span></div>
                            <div class="chart-segment"><span>MAYBE</span></div>
                            <div class="chart-segment"><span>LATER</span></div>
                            <div class="chart-segment"><span>UNKNOWN</span></div>
                        </div>
                    </div>
                    <div id="pendulum" class="pendulum">
                        <div class="pendulum-anchor"></div>
                        <div id="pendulumChain" class="pendulum-chain">
                            <div class="pendulum-weight"></div>
                        </div>
                        <div id="pendulumShadow" class="pendulum-shadow"></div>
                    </div>
                </div>

                <div class="detection-meter">
                    <div class="meter-label">Êé¢Áü•„É¨„Éô„É´</div>
                    <div class="meter-container">
                        <div id="meterFill" class="meter-fill"></div>
                        <div id="meterText" class="meter-text">0%</div>
                    </div>
                </div>

                <div id="detectionStatus" class="detection-status none">
                    ‰Ωï„ÇÇÊ§úÂá∫„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì
                </div>

                <div class="info">
                    üí° „Éá„Éê„Ç§„Çπ„ÇíÊßò„ÄÖ„Å™ÊñπÂêë„Å´Âãï„Åã„Åó„Å¶Êé¢Áü•„Åó„Å¶„Åø„Å¶„Åè„Å†„Åï„ÅÑ<br>
                    Âãï„Åç„ÅåÂ§ß„Åç„ÅÑ„Åª„Å©ÂèçÂøú„ÅåÂº∑„Åè„Å™„Çä„Åæ„Åô
                </div>
            </div>
        </div>

        <div class="info">
            üí° „Éá„Éê„Ç§„Çπ„ÇíÊßò„ÄÖ„Å™ÊñπÂêë„Å´Âãï„Åã„Åó„Å¶„Åø„Å¶„Åè„Å†„Åï„ÅÑ<br>
            Êõ¥Êñ∞È†ªÂ∫¶: 100ms
        </div>
    </div>

    <script>
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let debugLog = [];
        let isListening = false;
        let debugVisible = false;
        let currentTab = 'tilt';

        // Âä†ÈÄüÂ∫¶„Éá„Éº„Çø„ÅÆÂ±•Ê≠¥Ôºà„ÉÄ„Ç¶„Ç∏„É≥„Ç∞Áî®Ôºâ
        let accelerationHistory = [];
        let detectionLevel = 0;
        
        // ÊÑüÂ∫¶Ë®≠ÂÆö
        let sensitivity = 2.0;
        let tiltSensitivity = 1.0;

        // „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„ÇíÁîªÈù¢„Å´Ë°®Á§∫
        function log(message) {
            const now = new Date().toTimeString().split(' ')[0];
            const logMessage = `[${now}] ${message}`;
            debugLog.push(logMessage);
            
            // ÊúÄÊñ∞„ÅÆ10‰ª∂„ÅÆ„Åø‰øùÊåÅ
            if (debugLog.length > 10) {
                debugLog.shift();
            }
            
            const debugDiv = document.getElementById('debugInfo');
            debugDiv.textContent = debugLog.join('\n');
            
            // „Ç≥„É≥„ÇΩ„Éº„É´„Å´„ÇÇÂá∫Âäõ
            console.log(logMessage);
        }

        // „Éá„Éê„ÉÉ„Ç∞Ë°®Á§∫Âàá„ÇäÊõø„Åà
        document.getElementById('debugToggle').addEventListener('click', function() {
            debugVisible = !debugVisible;
            const debugDiv = document.getElementById('debugInfo');
            debugDiv.classList.toggle('active', debugVisible);
            this.textContent = debugVisible ? '‚úñÔ∏è' : 'üîß';
        });

        // ÊÑüÂ∫¶„Çπ„É©„Ç§„ÉÄ„Éº„ÅÆ„Ç§„Éô„É≥„Éà
        document.getElementById('sensitivitySlider').addEventListener('input', function(e) {
            sensitivity = parseFloat(e.target.value);
            tiltSensitivity = sensitivity / 2; // ÂÇæ„Åç„Çª„É≥„Çµ„Éº„ÅØÊéß„Åà„ÇÅ„Å´
            document.getElementById('sensitivityValue').textContent = 'x' + sensitivity.toFixed(1);
            log(`ÊÑüÂ∫¶„Çí${sensitivity.toFixed(1)}ÂÄç„Å´Â§âÊõ¥`);
        });

        // „Çø„ÉñÂàá„ÇäÊõø„Åà
        function switchTab(tabName) {
            currentTab = tabName;
            
            // „Çø„Éñ„Éú„Çø„É≥„ÅÆÁä∂ÊÖãÊõ¥Êñ∞
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.tab === tabName) {
                    tab.classList.add('active');
                }
            });
            
            // „Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅÆË°®Á§∫Âàá„ÇäÊõø„Åà
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName + 'Content').classList.add('active');
            
            log(`„Çø„Éñ„Çí${tabName}„Å´Âàá„ÇäÊõø„Åà„Åæ„Åó„Åü`);
        }

        // „Çø„Éñ„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                switchTab(tab.dataset.tab);
            });
        });

        // „Çπ„ÉÜ„Éº„Çø„ÇπÊõ¥Êñ∞
        function updateStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = 'status ' + type;
            log(`„Çπ„ÉÜ„Éº„Çø„Çπ: ${message} (${type})`);
        }

        // Áí∞Â¢ÉÊÉÖÂ†±„ÇíË®òÈå≤
        function logEnvironment() {
            log('=== Áí∞Â¢ÉÊÉÖÂ†± ===');
            log('UA: ' + navigator.userAgent.substring(0, 50) + '...');
            log('Protocol: ' + window.location.protocol);
            log('Host: ' + window.location.host);
            log('DeviceMotionEvent: ' + ('DeviceMotionEvent' in window ? '„ÅÇ„Çä' : '„Å™„Åó'));
            
            if (window.DeviceMotionEvent && window.DeviceMotionEvent.requestPermission) {
                log('requestPermission: „ÅÇ„ÇäÔºàiOS 13+Ôºâ');
            } else {
                log('requestPermission: „Å™„Åó');
            }
        }

        // === ÂÇæ„Åç„Çª„É≥„Çµ„ÉºÈñ¢ÈÄ£ ===

        // „Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº„ÇíÊõ¥Êñ∞
        function updateProgressBar(elementId, value, max = 10) {
            const progress = document.getElementById(elementId);
            if (!progress) return;
            
            const percentage = Math.min(Math.abs(value) / max * 50, 50);
            
            if (value >= 0) {
                progress.style.width = percentage + '%';
                progress.style.transform = 'translateX(0)';
            } else {
                progress.style.width = percentage + '%';
                progress.style.transform = 'translateX(-100%)';
            }
        }

        // 3D„Éá„Éê„Ç§„Çπ„ÇíÊõ¥Êñ∞
        function update3DDevice(x, y) {
            const device = document.getElementById('device3d');
            if (!device) return;
            
            const rotateX = -y * 3 * tiltSensitivity; // YËª∏„ÅÆÂÇæ„Åç„ÇíXËª∏ÂõûËª¢„Å´
            const rotateY = x * 3 * tiltSensitivity;  // XËª∏„ÅÆÂÇæ„Åç„ÇíYËª∏ÂõûËª¢„Å´
            device.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
        }

        // ÂÇæ„Åç„Éê„Éñ„É´„ÇíÊõ¥Êñ∞
        function updateTiltBubble(x, y) {
            const bubble = document.getElementById('tiltBubble');
            if (!bubble) return;
            
            const maxOffset = 55; // ÊúÄÂ§ßÁßªÂãïË∑ùÈõ¢
            const offsetX = (x / 10) * maxOffset * tiltSensitivity;
            const offsetY = (y / 10) * maxOffset * tiltSensitivity;
            bubble.style.transform = `translate(calc(-50% + ${offsetX}px), calc(-50% + ${offsetY}px))`;
        }

        // === „ÉÄ„Ç¶„Ç∏„É≥„Ç∞Èñ¢ÈÄ£ ===

        // Âä†ÈÄüÂ∫¶„ÅÆÂ§âÂåñÈáè„ÇíË®àÁÆó
        function calculateAccelerationChange(newX, newY, newZ) {
            accelerationHistory.push({ x: newX, y: newY, z: newZ, time: Date.now() });
            
            // ÊúÄÊñ∞„ÅÆ0.5ÁßíÈñì„ÅÆ„Éá„Éº„Çø„ÅÆ„Åø‰øùÊåÅÔºà„Çà„ÇäÈ´òÊÑüÂ∫¶„Å´Ôºâ
            const halfSecondAgo = Date.now() - 500;
            accelerationHistory = accelerationHistory.filter(data => data.time > halfSecondAgo);
            
            if (accelerationHistory.length < 2) return 0;
            
            // Â§âÂåñÈáè„ÅÆÂêàË®à„ÇíË®àÁÆó
            let totalChange = 0;
            let maxChange = 0;
            
            for (let i = 1; i < accelerationHistory.length; i++) {
                const prev = accelerationHistory[i - 1];
                const curr = accelerationHistory[i];
                
                const deltaX = curr.x - prev.x;
                const deltaY = curr.y - prev.y;
                const deltaZ = curr.z - prev.z;
                
                const change = Math.sqrt(deltaX * deltaX + deltaY * deltaY + deltaZ * deltaZ);
                totalChange += change;
                maxChange = Math.max(maxChange, change);
            }
            
            // Âπ≥ÂùáÂ§âÂåñÈáè„Å®ÊúÄÂ§ßÂ§âÂåñÈáè„ÅÆÁµÑ„ÅøÂêà„Çè„Åõ„Åß„ÄÅ„Çà„ÇäÊïèÊÑü„Å´ÂèçÂøú
            const avgChange = totalChange / (accelerationHistory.length - 1);
            return (avgChange + maxChange) / 2;
        }

        // „Éö„É≥„Éá„É•„É©„É†„ÇíÊõ¥Êñ∞
        function updatePendulum(x, y, changeLevel) {
            const pendulumChain = document.getElementById('pendulumChain');
            const pendulumShadow = document.getElementById('pendulumShadow');
            
            if (!pendulumChain || !pendulumShadow) return;
            
            // Âä†ÈÄüÂ∫¶„Éá„Éº„Çø„Å´Âü∫„Å•„ÅÑ„Å¶ÊåØ„ÇäÂ≠ê„ÅÆÂãï„Åç„ÇíË®àÁÆó
            const maxSwing = 30; // ÊúÄÂ§ßÊåØ„ÇåËßíÂ∫¶
            const swingX = (x / 10) * maxSwing * sensitivity;
            const swingY = (y / 10) * maxSwing * sensitivity;
            
            // Â§âÂåñÈáè„Å´Âøú„Åò„Å¶ÊåØ„ÇäÂ≠ê„ÅÆÂãï„Åç„ÇíÂ¢óÂπÖ
            const amplification = 1 + (changeLevel / 5);
            const finalSwingX = swingX * amplification;
            const finalSwingY = swingY * amplification;
            
            // ÊåØ„ÇäÂ≠ê„ÅÆÂõûËª¢„ÇíÈÅ©Áî®Ôºà„ÉÅ„Çß„Éº„É≥„ÅÆÊ†πÂÖÉ„ÇíÊîØÁÇπ„Å®„Åó„Å¶Ôºâ
            pendulumChain.style.transform = `rotateX(${finalSwingY}deg) rotateZ(${finalSwingX}deg)`;
            
            // ÂΩ±„ÅÆ‰ΩçÁΩÆ„ÇíÊõ¥Êñ∞ÔºàÊåØ„ÇäÂ≠ê„ÅÆÂãï„Åç„Å´Âêà„Çè„Åõ„Å¶Ôºâ
            const chainLength = 180;
            const shadowOffsetX = Math.sin(finalSwingX * Math.PI / 180) * chainLength;
            const shadowOffsetY = Math.sin(finalSwingY * Math.PI / 180) * chainLength * 0.5; // Êñú„ÇÅ„Éì„É•„Éº„ÅÆ„Åü„ÇÅË™øÊï¥
            const shadowScale = 1 - (Math.sqrt(finalSwingX * finalSwingX + finalSwingY * finalSwingY) / 90);
            
            pendulumShadow.style.transform = `translateX(calc(-50% + ${shadowOffsetX}px)) translateY(${shadowOffsetY}px) rotateX(90deg) scale(${shadowScale})`;
            
            // „ÉÅ„É£„Éº„Éà„Çª„Ç∞„É°„É≥„Éà„ÅÆ„Éè„Ç§„É©„Ç§„Éà
            updateChartHighlight(finalSwingX, finalSwingY);
        }
        
        // „ÉÅ„É£„Éº„Éà„ÅÆ„Éè„Ç§„É©„Ç§„Éà„ÇíÊõ¥Êñ∞
        function updateChartHighlight(swingX, swingY) {
            const segments = document.querySelectorAll('.chart-segment');
            if (!segments.length) return;
            
            // ÊåØ„ÇäÂ≠ê„ÅÆËßíÂ∫¶„Åã„ÇâÊñπÂêë„ÇíË®àÁÆó
            const angle = Math.atan2(swingY, swingX) * (180 / Math.PI);
            const distance = Math.sqrt(swingX * swingX + swingY * swingY);
            
            // Ë∑ùÈõ¢„ÅåÈñæÂÄ§‰ª•‰∏ä„ÅÆÂ†¥Âêà„ÅÆ„Åø„Éè„Ç§„É©„Ç§„Éà
            if (distance > 10) {
                // ËßíÂ∫¶„Çí0-360Â∫¶„Å´Ê≠£Ë¶èÂåñ
                let normalizedAngle = angle + 90; // ‰∏ä„Çí0Â∫¶„Å´„Åô„Çã
                if (normalizedAngle < 0) normalizedAngle += 360;
                
                // „Å©„ÅÆ„Çª„Ç∞„É°„É≥„Éà„Å´ÂØæÂøú„Åô„Çã„ÅãË®àÁÆóÔºà5ÂàÜÂâ≤Ôºâ
                const segmentIndex = Math.floor(normalizedAngle / 72) % 5;
                
                // „Éè„Ç§„É©„Ç§„Éà„ÇíÊõ¥Êñ∞
                segments.forEach((segment, index) => {
                    if (index === segmentIndex) {
                        segment.classList.add('highlight');
                    } else {
                        segment.classList.remove('highlight');
                    }
                });
                
                // ÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Çã„Çª„Ç∞„É°„É≥„Éà„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„ÇíÂèñÂæó
                const selectedText = segments[segmentIndex].querySelector('span').textContent;
                updateDetectionStatus(`${selectedText}„ÇíÊåá„Åó„Å¶„ÅÑ„Åæ„Åô`, 'strong');
            } else {
                // Ë∑ùÈõ¢„ÅåÁü≠„ÅÑÂ†¥Âêà„ÅØ„Éè„Ç§„É©„Ç§„Éà„ÇíËß£Èô§
                segments.forEach(segment => {
                    segment.classList.remove('highlight');
                });
            }
        }

        // Êé¢Áü•„É¨„Éô„É´„ÇíÊõ¥Êñ∞
        function updateDetectionLevel(changeLevel) {
            // ÊÑüÂ∫¶„ÇíÈÅ©Áî®„Åó„Å¶Êé¢Áü•„É¨„Éô„É´„ÇíË®àÁÆóÔºàÂü∫Êú¨ÊÑüÂ∫¶„ÇÇ‰∏ä„Åí„ÇãÔºâ
            detectionLevel = Math.min(changeLevel * 5 * sensitivity, 100);
            
            const meterFill = document.getElementById('meterFill');
            const meterText = document.getElementById('meterText');
            
            if (!meterFill || !meterText) return;
            
            // „É°„Éº„Çø„Éº„ÅÆÊõ¥Êñ∞
            meterFill.style.width = detectionLevel + '%';
            meterText.textContent = Math.round(detectionLevel) + '%';
        }
        
        // Êé¢Áü•„Çπ„ÉÜ„Éº„Çø„Çπ„ÇíÊõ¥Êñ∞
        function updateDetectionStatus(text, className) {
            const statusDiv = document.getElementById('detectionStatus');
            if (!statusDiv) return;
            
            statusDiv.textContent = text;
            statusDiv.className = 'detection-status ' + className;
        }

        // Âä†ÈÄüÂ∫¶„Éá„Éº„Çø„ÇíÊõ¥Êñ∞
        function updateSensorData(x, y, z) {
            if (currentTab === 'tilt') {
                // ÂÇæ„Åç„Çª„É≥„Çµ„Éº„Çø„Éñ
                // Êï∞ÂÄ§„ÇíÊõ¥Êñ∞
                const xEl = document.getElementById('xValue');
                const yEl = document.getElementById('yValue');
                const zEl = document.getElementById('zValue');
                
                if (xEl) xEl.textContent = x.toFixed(2);
                if (yEl) yEl.textContent = y.toFixed(2);
                if (zEl) zEl.textContent = z.toFixed(2);
                
                // „Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº„ÇíÊõ¥Êñ∞
                updateProgressBar('xProgress', x);
                updateProgressBar('yProgress', y);
                updateProgressBar('zProgress', z - 9.8); // ÈáçÂäõ„ÇíË£úÊ≠£
                
                // 3DË°®Á§∫„ÇíÊõ¥Êñ∞
                update3DDevice(x, y);
                
                // ÂÇæ„Åç„Éê„Éñ„É´„ÇíÊõ¥Êñ∞
                updateTiltBubble(x, y);
                
            } else if (currentTab === 'dowsing') {
                // „ÉÄ„Ç¶„Ç∏„É≥„Ç∞„Çø„Éñ
                const changeLevel = calculateAccelerationChange(x, y, z);
                updatePendulum(x, y, changeLevel);
                updateDetectionLevel(changeLevel);
            }
        }

        // „Çª„É≥„Çµ„ÉºÈñãÂßã
        async function startSensor() {
            log('startSensorÈñ¢Êï∞„ÅåÂëº„Å∞„Çå„Åæ„Åó„Åü');
            
            const button = document.getElementById('startButton');
            button.disabled = true;
            
            try {
                // iOS 13‰ª•Èôç„ÅÆÊ®©Èôê„ÉÅ„Çß„ÉÉ„ÇØ
                if (window.DeviceMotionEvent && typeof window.DeviceMotionEvent.requestPermission === 'function') {
                    log('iOS 13+„ÅÆÊ®©Èôê„Çí„É™„ÇØ„Ç®„Çπ„Éà‰∏≠...');
                    updateStatus('„Çª„É≥„Çµ„Éº„ÅÆÊ®©Èôê„ÇíÁ¢∫Ë™ç‰∏≠...', 'waiting');
                    
                    const permission = await window.DeviceMotionEvent.requestPermission();
                    log('Ê®©Èôê„ÅÆÁµêÊûú: ' + permission);
                    
                    if (permission !== 'granted') {
                        throw new Error('Ê®©Èôê„ÅåÊãíÂê¶„Åï„Çå„Åæ„Åó„Åü');
                    }
                }
                
                // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíË®≠ÂÆö
                if (!isListening) {
                    log('devicemotion„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíË®≠ÂÆö‰∏≠...');
                    
                    let eventCount = 0;
                    let lastUpdate = 0;
                    
                    window.addEventListener('devicemotion', function(event) {
                        eventCount++;
                        
                        // ÂàùÂõû„Ç§„Éô„É≥„Éà„Çí„É≠„Ç∞
                        if (eventCount === 1) {
                            log('ÊúÄÂàù„ÅÆ„Ç§„Éô„É≥„Éà„ÇíÂèó‰ø°ÔºÅ');
                            document.getElementById('sensorData').classList.add('active');
                            if (currentTab === 'dowsing') {
                                document.getElementById('dowsingData').classList.add('active');
                            }
                            updateStatus('„Çª„É≥„Çµ„ÉºÂãï‰Ωú‰∏≠ üéØ', 'success');
                        }
                        
                        // 100msÈñìÈöî„ÅßÊõ¥Êñ∞
                        const now = Date.now();
                        if (now - lastUpdate < 100) return;
                        lastUpdate = now;
                        
                        // Âä†ÈÄüÂ∫¶„Éá„Éº„Çø„ÇíÂèñÂæó
                        if (event.accelerationIncludingGravity) {
                            const acc = event.accelerationIncludingGravity;
                            updateSensorData(
                                acc.x || 0,
                                acc.y || 0,
                                acc.z || 0
                            );
                        }
                    });
                    
                    isListening = true;
                    log('„É™„Çπ„Éä„ÉºË®≠ÂÆöÂÆå‰∫Ü');
                    
                    // 3ÁßíÂæå„Å´„Ç§„Éô„É≥„Éà„ÅåÊù•„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                    setTimeout(function() {
                        if (eventCount === 0) {
                            log('Ë≠¶Âëä: 3ÁßíÁµå„Å£„Å¶„ÇÇ„Ç§„Éô„É≥„Éà„ÅåÊù•„Åæ„Åõ„Çì');
                            updateStatus('„Çª„É≥„Çµ„Éº„ÅåÂèçÂøú„Åó„Åæ„Åõ„Çì„ÄÇ„Éá„Éê„Ç§„Çπ„ÇíÂãï„Åã„Åó„Å¶„Åø„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                        } else {
                            log(`3ÁßíÈñì„Åß${eventCount}ÂÄã„ÅÆ„Ç§„Éô„É≥„Éà„ÇíÂèó‰ø°`);
                        }
                    }, 3000);
                }
                
                button.textContent = '‚ú® „Çª„É≥„Çµ„ÉºÂãï‰Ωú‰∏≠';
                updateStatus('„Çª„É≥„Çµ„Éº„ÇíËµ∑Âãï„Åó„Åæ„Åó„Åü', 'success');
                
            } catch (error) {
                log('„Ç®„É©„Éº: ' + error.message);
                updateStatus('„Ç®„É©„Éº: ' + error.message, 'error');
                button.disabled = false;
            }
        }

        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            log('„Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÂÆå‰∫Ü');
            logEnvironment();
            
            const button = document.getElementById('startButton');
            
            // DeviceMotionEvent„Åå‰Ωø„Åà„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
            if (!window.DeviceMotionEvent) {
                log('„Ç®„É©„Éº: DeviceMotionEvent„Åå„Çµ„Éù„Éº„Éà„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì');
                updateStatus('„Åì„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØÂä†ÈÄüÂ∫¶„Çª„É≥„Çµ„Éº„Å´ÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì', 'error');
                button.disabled = true;
                return;
            }
            
            // „Éú„Çø„É≥„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà
            button.addEventListener('click', function() {
                log('„Éú„Çø„É≥„Åå„ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„Åü');
                startSensor();
            });
            
            log('ÂàùÊúüÂåñÂÆå‰∫Ü');
        });
    </script>
</body>
</html>