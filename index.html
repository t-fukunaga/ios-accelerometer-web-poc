<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>„Éá„Éê„Ç§„ÇπÂÇæ„Åç„Çª„É≥„Çµ„Éº</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
            font-weight: 600;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 25px;
            font-size: 14px;
        }

        /* „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„Éà„Ç∞„É´ */
        .debug-toggle {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.1);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .debug-toggle:hover {
            background: rgba(0,0,0,0.2);
        }

        .debug-info {
            display: none;
            background: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 12px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }

        .debug-info.active {
            display: block;
        }

        /* 3D„Éá„Éê„Ç§„ÇπË°®Á§∫ */
        .device-visualizer {
            margin: 30px auto;
            width: 200px;
            height: 200px;
            perspective: 800px;
        }

        .device-3d {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.1s ease-out;
        }

        .device-face {
            position: absolute;
            width: 120px;
            height: 180px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 2px solid rgba(255,255,255,0.8);
            border-radius: 15px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            color: rgba(255,255,255,0.9);
            box-shadow: 0 0 30px rgba(102, 126, 234, 0.5);
        }

        /* „Çπ„ÉÜ„Éº„Çø„Çπ */
        .status {
            text-align: center;
            padding: 12px;
            margin-bottom: 20px;
            border-radius: 10px;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .status.waiting {
            background: #e3f2fd;
            color: #1976d2;
        }

        .status.success {
            background: #e8f5e9;
            color: #388e3c;
        }

        .status.error {
            background: #ffebee;
            color: #d32f2f;
        }

        /* „Çπ„Çø„Éº„Éà„Éú„Çø„É≥ */
        .start-button {
            display: block;
            width: 100%;
            padding: 16px;
            font-size: 18px;
            font-weight: 600;
            color: white;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
        }

        .start-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .start-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* „Çª„É≥„Çµ„Éº„Éá„Éº„ÇøË°®Á§∫ */
        .sensor-data {
            display: none;
        }

        .sensor-data.active {
            display: block;
        }

        /* Ëª∏„Åî„Å®„ÅÆ„Éá„Éº„ÇøË°®Á§∫ */
        .axis-container {
            margin-bottom: 20px;
        }

        .axis-item {
            margin-bottom: 20px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .axis-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .axis-label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 18px;
        }

        .axis-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 16px;
        }

        .axis-x .axis-icon { background: #e74c3c; }
        .axis-y .axis-icon { background: #2ecc71; }
        .axis-z .axis-icon { background: #3498db; }

        .axis-value {
            font-size: 20px;
            font-weight: 700;
            font-variant-numeric: tabular-nums;
        }

        /* „Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº */
        .progress-container {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: currentColor;
            transition: width 0.1s ease-out;
            position: absolute;
            left: 50%;
            transform-origin: left center;
        }

        .axis-x .progress-bar { background: #e74c3c; }
        .axis-y .progress-bar { background: #2ecc71; }
        .axis-z .progress-bar { background: #3498db; }

        /* Ë™¨Êòé„ÉÜ„Ç≠„Çπ„Éà */
        .axis-description {
            font-size: 12px;
            color: #666;
            margin-top: 8px;
        }

        /* ÂÇæ„ÅçÊñπÂêë„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº */
        .tilt-indicator {
            margin: 20px auto;
            width: 150px;
            height: 150px;
            position: relative;
            background: #f0f0f0;
            border-radius: 50%;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
        }

        .tilt-bubble {
            position: absolute;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.5);
            transition: all 0.1s ease-out;
        }

        .info {
            font-size: 13px;
            color: #666;
            text-align: center;
            margin-top: 20px;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <button id="debugToggle" class="debug-toggle" title="„Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±">
            üîß
        </button>

        <h1>üì± „Éá„Éê„Ç§„ÇπÂÇæ„Åç„Çª„É≥„Çµ„Éº</h1>
        <p class="subtitle">„Éá„Éê„Ç§„Çπ„ÇíÂÇæ„Åë„Çã„Å®ÂèçÂøú„Åó„Åæ„Åô</p>
        
        <div id="debugInfo" class="debug-info">
            „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô...
        </div>

        <div id="status" class="status waiting">
            ÈñãÂßã„Éú„Çø„É≥„Çí„Çø„ÉÉ„Éó„Åó„Å¶„Åè„Å†„Åï„ÅÑ
        </div>

        <button id="startButton" class="start-button">
            „Çª„É≥„Çµ„Éº„ÇíÈñãÂßã
        </button>

        <div id="sensorData" class="sensor-data">
            <!-- 3D„Éá„Éê„Ç§„ÇπË°®Á§∫ -->
            <div class="device-visualizer">
                <div id="device3d" class="device-3d">
                    <div class="device-face">üì±</div>
                </div>
            </div>

            <!-- ÂÇæ„Åç„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº -->
            <div class="tilt-indicator">
                <div id="tiltBubble" class="tilt-bubble"></div>
            </div>

            <!-- ÂêÑËª∏„ÅÆ„Éá„Éº„Çø -->
            <div class="axis-container">
                <div class="axis-item axis-x">
                    <div class="axis-header">
                        <div class="axis-label">
                            <div class="axis-icon">X</div>
                            <span>Â∑¶Âè≥„ÅÆÂÇæ„Åç</span>
                        </div>
                        <div class="axis-value" id="xValue">0.00</div>
                    </div>
                    <div class="progress-container">
                        <div id="xProgress" class="progress-bar"></div>
                    </div>
                    <div class="axis-description">Â∑¶„Å´ÂÇæ„Åë„Çã ‚Üê ‚Üí Âè≥„Å´ÂÇæ„Åë„Çã</div>
                </div>

                <div class="axis-item axis-y">
                    <div class="axis-header">
                        <div class="axis-label">
                            <div class="axis-icon">Y</div>
                            <span>ÂâçÂæå„ÅÆÂÇæ„Åç</span>
                        </div>
                        <div class="axis-value" id="yValue">0.00</div>
                    </div>
                    <div class="progress-container">
                        <div id="yProgress" class="progress-bar"></div>
                    </div>
                    <div class="axis-description">ÊâãÂâç„Å´ÂÇæ„Åë„Çã ‚Üê ‚Üí Â••„Å´ÂÇæ„Åë„Çã</div>
                </div>

                <div class="axis-item axis-z">
                    <div class="axis-header">
                        <div class="axis-label">
                            <div class="axis-icon">Z</div>
                            <span>‰∏ä‰∏ã„ÅÆÂãï„Åç</span>
                        </div>
                        <div class="axis-value" id="zValue">0.00</div>
                    </div>
                    <div class="progress-container">
                        <div id="zProgress" class="progress-bar"></div>
                    </div>
                    <div class="axis-description">‰∏ãÂêë„Åç ‚Üê ‚Üí ‰∏äÂêë„Åç</div>
                </div>
            </div>
        </div>

        <div class="info">
            üí° „Éá„Éê„Ç§„Çπ„ÇíÊßò„ÄÖ„Å™ÊñπÂêë„Å´ÂÇæ„Åë„Å¶„Åø„Å¶„Åè„Å†„Åï„ÅÑ<br>
            Êõ¥Êñ∞È†ªÂ∫¶: 100ms
        </div>
    </div>

    <script>
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let debugLog = [];
        let isListening = false;
        let debugVisible = false;

        // „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„ÇíÁîªÈù¢„Å´Ë°®Á§∫
        function log(message) {
            const now = new Date().toTimeString().split(' ')[0];
            const logMessage = `[${now}] ${message}`;
            debugLog.push(logMessage);
            
            // ÊúÄÊñ∞„ÅÆ10‰ª∂„ÅÆ„Åø‰øùÊåÅ
            if (debugLog.length > 10) {
                debugLog.shift();
            }
            
            const debugDiv = document.getElementById('debugInfo');
            debugDiv.textContent = debugLog.join('\n');
            
            // „Ç≥„É≥„ÇΩ„Éº„É´„Å´„ÇÇÂá∫Âäõ
            console.log(logMessage);
        }

        // „Éá„Éê„ÉÉ„Ç∞Ë°®Á§∫Âàá„ÇäÊõø„Åà
        document.getElementById('debugToggle').addEventListener('click', function() {
            debugVisible = !debugVisible;
            const debugDiv = document.getElementById('debugInfo');
            debugDiv.classList.toggle('active', debugVisible);
            this.textContent = debugVisible ? '‚úñÔ∏è' : 'üîß';
        });

        // „Çπ„ÉÜ„Éº„Çø„ÇπÊõ¥Êñ∞
        function updateStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = 'status ' + type;
            log(`„Çπ„ÉÜ„Éº„Çø„Çπ: ${message} (${type})`);
        }

        // Áí∞Â¢ÉÊÉÖÂ†±„ÇíË®òÈå≤
        function logEnvironment() {
            log('=== Áí∞Â¢ÉÊÉÖÂ†± ===');
            log('UA: ' + navigator.userAgent.substring(0, 50) + '...');
            log('Protocol: ' + window.location.protocol);
            log('Host: ' + window.location.host);
            log('DeviceMotionEvent: ' + ('DeviceMotionEvent' in window ? '„ÅÇ„Çä' : '„Å™„Åó'));
            
            if (window.DeviceMotionEvent && window.DeviceMotionEvent.requestPermission) {
                log('requestPermission: „ÅÇ„ÇäÔºàiOS 13+Ôºâ');
            } else {
                log('requestPermission: „Å™„Åó');
            }
        }

        // „Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº„ÇíÊõ¥Êñ∞
        function updateProgressBar(elementId, value, max = 10) {
            const progress = document.getElementById(elementId);
            const percentage = Math.min(Math.abs(value) / max * 50, 50);
            
            if (value >= 0) {
                progress.style.width = percentage + '%';
                progress.style.transform = 'translateX(0)';
            } else {
                progress.style.width = percentage + '%';
                progress.style.transform = 'translateX(-100%)';
            }
        }

        // 3D„Éá„Éê„Ç§„Çπ„ÇíÊõ¥Êñ∞
        function update3DDevice(x, y) {
            const device = document.getElementById('device3d');
            const rotateX = -y * 3; // YËª∏„ÅÆÂÇæ„Åç„ÇíXËª∏ÂõûËª¢„Å´
            const rotateY = x * 3;  // XËª∏„ÅÆÂÇæ„Åç„ÇíYËª∏ÂõûËª¢„Å´
            device.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
        }

        // ÂÇæ„Åç„Éê„Éñ„É´„ÇíÊõ¥Êñ∞
        function updateTiltBubble(x, y) {
            const bubble = document.getElementById('tiltBubble');
            const maxOffset = 55; // ÊúÄÂ§ßÁßªÂãïË∑ùÈõ¢
            const offsetX = (x / 10) * maxOffset;
            const offsetY = (y / 10) * maxOffset;
            bubble.style.transform = `translate(calc(-50% + ${offsetX}px), calc(-50% + ${offsetY}px))`;
        }

        // Âä†ÈÄüÂ∫¶„Éá„Éº„Çø„ÇíÊõ¥Êñ∞
        function updateSensorData(x, y, z) {
            // Êï∞ÂÄ§„ÇíÊõ¥Êñ∞
            document.getElementById('xValue').textContent = x.toFixed(2);
            document.getElementById('yValue').textContent = y.toFixed(2);
            document.getElementById('zValue').textContent = z.toFixed(2);
            
            // „Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº„ÇíÊõ¥Êñ∞
            updateProgressBar('xProgress', x);
            updateProgressBar('yProgress', y);
            updateProgressBar('zProgress', z - 9.8); // ÈáçÂäõ„ÇíË£úÊ≠£
            
            // 3DË°®Á§∫„ÇíÊõ¥Êñ∞
            update3DDevice(x, y);
            
            // ÂÇæ„Åç„Éê„Éñ„É´„ÇíÊõ¥Êñ∞
            updateTiltBubble(x, y);
        }

        // „Çª„É≥„Çµ„ÉºÈñãÂßã
        async function startSensor() {
            log('startSensorÈñ¢Êï∞„ÅåÂëº„Å∞„Çå„Åæ„Åó„Åü');
            
            const button = document.getElementById('startButton');
            button.disabled = true;
            
            try {
                // iOS 13‰ª•Èôç„ÅÆÊ®©Èôê„ÉÅ„Çß„ÉÉ„ÇØ
                if (window.DeviceMotionEvent && typeof window.DeviceMotionEvent.requestPermission === 'function') {
                    log('iOS 13+„ÅÆÊ®©Èôê„Çí„É™„ÇØ„Ç®„Çπ„Éà‰∏≠...');
                    updateStatus('„Çª„É≥„Çµ„Éº„ÅÆÊ®©Èôê„ÇíÁ¢∫Ë™ç‰∏≠...', 'waiting');
                    
                    const permission = await window.DeviceMotionEvent.requestPermission();
                    log('Ê®©Èôê„ÅÆÁµêÊûú: ' + permission);
                    
                    if (permission !== 'granted') {
                        throw new Error('Ê®©Èôê„ÅåÊãíÂê¶„Åï„Çå„Åæ„Åó„Åü');
                    }
                }
                
                // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíË®≠ÂÆö
                if (!isListening) {
                    log('devicemotion„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíË®≠ÂÆö‰∏≠...');
                    
                    let eventCount = 0;
                    let lastUpdate = 0;
                    
                    window.addEventListener('devicemotion', function(event) {
                        eventCount++;
                        
                        // ÂàùÂõû„Ç§„Éô„É≥„Éà„Çí„É≠„Ç∞
                        if (eventCount === 1) {
                            log('ÊúÄÂàù„ÅÆ„Ç§„Éô„É≥„Éà„ÇíÂèó‰ø°ÔºÅ');
                            document.getElementById('sensorData').classList.add('active');
                            updateStatus('„Çª„É≥„Çµ„ÉºÂãï‰Ωú‰∏≠ üéØ', 'success');
                        }
                        
                        // 100msÈñìÈöî„ÅßÊõ¥Êñ∞
                        const now = Date.now();
                        if (now - lastUpdate < 100) return;
                        lastUpdate = now;
                        
                        // Âä†ÈÄüÂ∫¶„Éá„Éº„Çø„ÇíÂèñÂæó
                        if (event.accelerationIncludingGravity) {
                            const acc = event.accelerationIncludingGravity;
                            updateSensorData(
                                acc.x || 0,
                                acc.y || 0,
                                acc.z || 0
                            );
                        }
                    });
                    
                    isListening = true;
                    log('„É™„Çπ„Éä„ÉºË®≠ÂÆöÂÆå‰∫Ü');
                    
                    // 3ÁßíÂæå„Å´„Ç§„Éô„É≥„Éà„ÅåÊù•„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                    setTimeout(function() {
                        if (eventCount === 0) {
                            log('Ë≠¶Âëä: 3ÁßíÁµå„Å£„Å¶„ÇÇ„Ç§„Éô„É≥„Éà„ÅåÊù•„Åæ„Åõ„Çì');
                            updateStatus('„Çª„É≥„Çµ„Éº„ÅåÂèçÂøú„Åó„Åæ„Åõ„Çì„ÄÇ„Éá„Éê„Ç§„Çπ„ÇíÂãï„Åã„Åó„Å¶„Åø„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                        } else {
                            log(`3ÁßíÈñì„Åß${eventCount}ÂÄã„ÅÆ„Ç§„Éô„É≥„Éà„ÇíÂèó‰ø°`);
                        }
                    }, 3000);
                }
                
                button.textContent = '‚ú® „Çª„É≥„Çµ„ÉºÂãï‰Ωú‰∏≠';
                updateStatus('„Çª„É≥„Çµ„Éº„ÇíËµ∑Âãï„Åó„Åæ„Åó„Åü', 'success');
                
            } catch (error) {
                log('„Ç®„É©„Éº: ' + error.message);
                updateStatus('„Ç®„É©„Éº: ' + error.message, 'error');
                button.disabled = false;
            }
        }

        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            log('„Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÂÆå‰∫Ü');
            logEnvironment();
            
            const button = document.getElementById('startButton');
            
            // DeviceMotionEvent„Åå‰Ωø„Åà„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
            if (!window.DeviceMotionEvent) {
                log('„Ç®„É©„Éº: DeviceMotionEvent„Åå„Çµ„Éù„Éº„Éà„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì');
                updateStatus('„Åì„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØÂä†ÈÄüÂ∫¶„Çª„É≥„Çµ„Éº„Å´ÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì', 'error');
                button.disabled = true;
                return;
            }
            
            // „Éú„Çø„É≥„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà
            button.addEventListener('click', function() {
                log('„Éú„Çø„É≥„Åå„ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„Åü');
                startSensor();
            });
            
            log('ÂàùÊúüÂåñÂÆå‰∫Ü');
        });
    </script>
</body>
</html>