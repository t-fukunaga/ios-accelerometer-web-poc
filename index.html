<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Âä†ÈÄüÂ∫¶„Çª„É≥„Çµ„Éº „Éá„É¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
            font-weight: 600;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 25px;
            font-size: 14px;
        }

        /* „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„Éà„Ç∞„É´ */
        .debug-toggle {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.1);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .debug-toggle:hover {
            background: rgba(0, 0, 0, 0.2);
        }

        .debug-info {
            display: none;
            background: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 12px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }

        .debug-info.active {
            display: block;
        }

        /* „Çø„Éñ„Ç∑„Çπ„ÉÜ„É† */
        .tabs {
            display: flex;
            margin-bottom: 25px;
            background: #f0f0f0;
            border-radius: 12px;
            padding: 4px;
        }

        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #666;
        }

        .tab.active {
            background: white;
            color: #333;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.5);
        }

        /* „Çø„Éñ„Ç≥„É≥„ÉÜ„É≥„ÉÑ */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* „Çπ„ÉÜ„Éº„Çø„Çπ */
        .status {
            text-align: center;
            padding: 12px;
            margin-bottom: 20px;
            border-radius: 10px;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .status.waiting {
            background: #e3f2fd;
            color: #1976d2;
        }

        .status.success {
            background: #e8f5e9;
            color: #388e3c;
        }

        .status.error {
            background: #ffebee;
            color: #d32f2f;
        }

        /* „Çπ„Çø„Éº„Éà„Éú„Çø„É≥ */
        .start-button {
            display: block;
            width: 100%;
            padding: 16px;
            font-size: 18px;
            font-weight: 600;
            color: white;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
        }

        .start-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .start-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* „Çª„É≥„Çµ„Éº„Éá„Éº„ÇøË°®Á§∫ */
        .sensor-data {
            display: none;
        }

        .sensor-data.active {
            display: block;
        }

        /* === „Çø„Éñ1: ÂÇæ„Åç„Çª„É≥„Çµ„Éº === */

        /* 3D„Éá„Éê„Ç§„ÇπË°®Á§∫ */
        .device-visualizer {
            margin: 30px auto;
            width: 200px;
            height: 200px;
            perspective: 800px;
        }

        .device-3d {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.1s ease-out;
        }

        .device-face {
            position: absolute;
            width: 120px;
            height: 180px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 2px solid rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            color: rgba(255, 255, 255, 0.9);
            box-shadow: 0 0 30px rgba(102, 126, 234, 0.5);
        }

        /* Ëª∏„Åî„Å®„ÅÆ„Éá„Éº„ÇøË°®Á§∫ */
        .axis-container {
            margin-bottom: 20px;
        }

        .axis-item {
            margin-bottom: 20px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .axis-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .axis-label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 18px;
        }

        .axis-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 16px;
        }

        .axis-x .axis-icon {
            background: #e74c3c;
        }

        .axis-y .axis-icon {
            background: #2ecc71;
        }

        .axis-z .axis-icon {
            background: #3498db;
        }

        .axis-value {
            font-size: 20px;
            font-weight: 700;
            font-variant-numeric: tabular-nums;
        }

        /* „Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº */
        .progress-container {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: currentColor;
            transition: width 0.1s ease-out;
            position: absolute;
            left: 50%;
            transform-origin: left center;
        }

        .axis-x .progress-bar {
            background: #e74c3c;
        }

        .axis-y .progress-bar {
            background: #2ecc71;
        }

        .axis-z .progress-bar {
            background: #3498db;
        }

        /* Ë™¨Êòé„ÉÜ„Ç≠„Çπ„Éà */
        .axis-description {
            font-size: 12px;
            color: #666;
            margin-top: 8px;
        }

        /* ÂÇæ„ÅçÊñπÂêë„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº */
        .tilt-indicator {
            margin: 20px auto;
            width: 150px;
            height: 150px;
            position: relative;
            background: #f0f0f0;
            border-radius: 50%;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.1);
        }

        .tilt-bubble {
            position: absolute;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.5);
            transition: all 0.1s ease-out;
        }

        /* === „Çø„Éñ2: „ÉÄ„Ç¶„Ç∏„É≥„Ç∞ === */

        .dowsing-container {
            text-align: center;
        }

        .pendulum-container {
            margin: 20px auto;
            width: 350px;
            height: 350px;
            position: relative;
            perspective: 800px;
        }

        /* „ÉÄ„Ç¶„Ç∏„É≥„Ç∞„ÉÅ„É£„Éº„Éà */
        .dowsing-chart {
            position: absolute;
            width: 350px;
            height: 350px;
            left: 0;
            top: 135px;
            transform: rotateX(60deg);
            transform-style: preserve-3d;
        }

        .chart-circle {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 4px solid #667eea;
            border-radius: 50%;
            background: radial-gradient(circle at center,
                    rgba(255, 255, 255, 0.95) 0%,
                    rgba(240, 243, 255, 0.9) 40%,
                    rgba(230, 235, 255, 0.85) 100%);
            box-shadow:
                0 10px 30px rgba(102, 126, 234, 0.2),
                inset 0 2px 10px rgba(102, 126, 234, 0.1);
        }

        .chart-center {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #667eea;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
        }

        /* „Éö„É≥„Éá„É•„É©„É† */
        .pendulum {
            position: absolute;
            left: 50%;
            top: 10%;
            transform: translateX(-50%);
            transform-style: preserve-3d;
            z-index: 10;
        }

        .pendulum-anchor {
            position: absolute;
            width: 10px;
            height: 10px;
            background: radial-gradient(circle, #666 0%, #444 100%);
            border-radius: 50%;
            left: 50%;
            top: 0;
            transform: translateX(-50%);
            z-index: 2;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .pendulum-chain {
            position: absolute;
            width: 1px;
            height: 220px;
            left: 50%;
            top: 5px;
            transform: translateX(-50%);
            transform-origin: top center;
            transform-style: preserve-3d;
        }

        .pendulum-chain::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg,
                    rgba(200, 200, 200, 0.8) 0%,
                    rgba(150, 150, 150, 0.9) 50%,
                    rgba(100, 100, 100, 1) 100%);
            box-shadow: 0 0 2px rgba(0, 0, 0, 0.2);
        }

        .pendulum-weight {
            position: absolute;
            width: 40px;
            height: 50px;
            background: linear-gradient(145deg,
                    #9b59b6 0%,
                    #8e44ad 30%,
                    #6c3483 60%,
                    #5b2c6f 100%);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            left: 50%;
            top: 100%;
            /* Èéñ„ÅÆÊú´Á´Ø„Å´„Åä„ÇÇ„Çä„ÅÆ‰∏äÈÉ®„ÇíÊé•Á∂ö */
            transform: translateX(-50%);
            box-shadow:
                0 8px 20px rgba(107, 52, 131, 0.4),
                inset 0 -3px 8px rgba(0, 0, 0, 0.2),
                inset 0 2px 6px rgba(255, 255, 255, 0.3);
            z-index: -1;
            /* Èéñ„ÅåÊâãÂâç„Å´Êù•„Çã„Çà„ÅÜ„Å´Ë™øÊï¥ */
        }

        .pendulum-weight::before {
            content: '';
            position: absolute;
            width: 15px;
            height: 15px;
            background: radial-gradient(circle at 30% 30%,
                    rgba(255, 255, 255, 0.8) 0%,
                    rgba(255, 255, 255, 0.4) 40%,
                    transparent 70%);
            border-radius: 50%;
            top: 8px;
            left: 8px;
        }

        .pendulum-weight::after {
            content: '';
            position: absolute;
            width: 12px;
            height: 12px;
            background: radial-gradient(circle,
                    rgba(255, 255, 255, 0) 0%,
                    rgba(255, 255, 255, 0.2) 50%,
                    rgba(255, 255, 255, 0) 100%);
            border-radius: 50%;
            bottom: 5px;
            right: 5px;
            animation: sparkle 2s infinite;
        }

        @keyframes sparkle {

            0%,
            100% {
                opacity: 0.5;
            }

            50% {
                opacity: 1;
            }
        }

        .pendulum-shadow {
            position: absolute;
            width: 60px;
            height: 30px;
            background: radial-gradient(ellipse at center,
                    rgba(0, 0, 0, 0.4) 0%,
                    rgba(0, 0, 0, 0.2) 40%,
                    transparent 70%);
            top: 300px;
            left: 50%;
            transform: translateX(-50%) rotateX(90deg);
            filter: blur(2px);
        }

        @keyframes pulse {

            0%,
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 0.3;
            }

            50% {
                transform: translate(-50%, -50%) scale(1.1);
                opacity: 0.6;
            }
        }


        .detection-meter {
            margin: 150px auto 30px auto;
            width: 250px;
        }

        .meter-label {
            text-align: center;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .meter-container {
            background: #f0f0f0;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .meter-fill {
            height: 100%;
            background: linear-gradient(90deg, #2ecc71 0%, #f39c12 50%, #e74c3c 100%);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .meter-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
            font-weight: bold;
            color: #333;
        }

        .detection-status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
            text-align: center;
            transition: all 0.3s ease;
        }

        .detection-status.none {
            background: #f8f9fa;
            color: #666;
        }

        .detection-status.weak {
            background: #e8f5e9;
            color: #2ecc71;
        }

        .detection-status.strong {
            background: #fff3cd;
            color: #f39c12;
        }

        .detection-status.very-strong {
            background: #ffebee;
            color: #e74c3c;
            animation: glow 1s infinite alternate;
        }

        @keyframes glow {
            from {
                box-shadow: 0 0 10px rgba(231, 76, 60, 0.3);
            }

            to {
                box-shadow: 0 0 20px rgba(231, 76, 60, 0.6);
            }
        }

        .info {
            font-size: 13px;
            color: #666;
            text-align: center;
            margin-top: 20px;
            line-height: 1.6;
        }

        /* ÊÑüÂ∫¶Ë™øÊï¥„Çπ„É©„Ç§„ÉÄ„Éº */
        .sensitivity-control {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .sensitivity-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-weight: 600;
            font-size: 14px;
        }

        .sensitivity-value {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .sensitivity-slider {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: #e0e0e0;
            border-radius: 4px;
            outline: none;
            transition: all 0.3s ease;
        }

        .sensitivity-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
        }

        .sensitivity-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.5);
        }

        .sensitivity-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
            border: none;
        }

        .sensitivity-slider::-moz-range-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.5);
        }

        .sensitivity-description {
            font-size: 12px;
            color: #666;
            margin-top: 8px;
            text-align: center;
        }

        /* === „Çø„Éñ3: Áúü‰∏ä„Åã„ÇâË¶ã„Çã === */
        .top-down-visualizer {
            margin: 30px auto;
            width: 300px;
            height: 300px;
            position: relative;
            background: #f0f0f0;
            border-radius: 50%;
            border: 2px solid #ccc;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.1);
        }

        .top-down-visualizer::before,
        .top-down-visualizer::after {
            content: '';
            position: absolute;
            background: #ddd;
        }

        .top-down-visualizer::before {
            /* Horizontal line */
            width: 100%;
            height: 1px;
            top: 50%;
            left: 0;
        }

        .top-down-visualizer::after {
            /* Vertical line */
            width: 1px;
            height: 100%;
            top: 0;
            left: 50%;
        }

        .top-down-chain {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 2;
        }

        .top-down-bubble {
            position: absolute;
            width: 30px;
            height: 30px;
            background: linear-gradient(145deg,
                    #9b59b6 0%,
                    #8e44ad 30%,
                    #6c3483 60%,
                    #5b2c6f 100%);
            border-radius: 50%;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 4px 15px rgba(107, 52, 131, 0.5);
            transition: all 0.1s ease-out;
            z-index: 1;
        }

        /* „É¢„Éº„Éâ„Åî„Å®„ÅÆË™¨Êòé */
        .mode-instruction {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .mode-instruction p {
            font-size: 13px;
            color: #333;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .instruction-diagram {
            font-family: monospace;
            font-size: 12px;
            color: #666;
            background: #fff;
            padding: 10px;
            border-radius: 8px;
            white-space: pre;
            display: inline-block;
            border: 1px solid #eee;
        }
    </style>
</head>

<body>
    <div class="container">
        <button id="debugToggle" class="debug-toggle" title="„Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±">
            üîß
        </button>

        <h1>üì± Âä†ÈÄüÂ∫¶„Çª„É≥„Çµ„Éº „Éá„É¢</h1>
        <p class="subtitle">„Çø„Éñ„ÇíÂàá„ÇäÊõø„Åà„Å¶Êßò„ÄÖ„Å™„Éá„É¢„Çí‰ΩìÈ®ì</p>

        <div id="debugInfo" class="debug-info">
            „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô...
        </div>

        <div class="tabs">
            <button class="tab" data-tab="tilt">üîÑ ÂÇæ„Åç„Çª„É≥„Çµ„Éº</button>
            <button class="tab active" data-tab="dowsing">ü™Ñ „ÉÄ„Ç¶„Ç∏„É≥„Ç∞</button>
            <button class="tab" data-tab="topDown">üî≠ Áúü‰∏ä„Åã„ÇâË¶ã„Çã</button>
        </div>

        <div id="status" class="status waiting">
            ÈñãÂßã„Éú„Çø„É≥„Çí„Çø„ÉÉ„Éó„Åó„Å¶„Åè„Å†„Åï„ÅÑ
        </div>

        <button id="startButton" class="start-button">
            „Çª„É≥„Çµ„Éº„ÇíÈñãÂßã
        </button>

        <div class="sensitivity-control">
            <div class="sensitivity-label">
                <span>üéöÔ∏è ÊÑüÂ∫¶Ë™øÊï¥</span>
                <span class="sensitivity-value" id="sensitivityValue">x2.0</span>
            </div>
            <input type="range" class="sensitivity-slider" id="sensitivitySlider" min="0.5" max="25" step="0.1"
                value="2">
            <div class="sensitivity-description">
                ‰ΩéÊÑüÂ∫¶ ‚Üê ‚Üí È´òÊÑüÂ∫¶
            </div>
        </div>

        <div id="tiltContent" class="tab-content">
            <div id="sensorData" class="sensor-data">
                <div class="device-visualizer">
                    <div id="device3d" class="device-3d">
                        <div class="device-face">üì±</div>
                    </div>
                </div>

                <div class="tilt-indicator">
                    <div id="tiltBubble" class="tilt-bubble"></div>
                </div>

                <div class="axis-container">
                    <div class="axis-item axis-x">
                        <div class="axis-header">
                            <div class="axis-label">
                                <div class="axis-icon">X</div>
                                <span>Â∑¶Âè≥„ÅÆÂÇæ„Åç</span>
                            </div>
                            <div class="axis-value" id="xValue">0.00</div>
                        </div>
                        <div class="progress-container">
                            <div id="xProgress" class="progress-bar"></div>
                        </div>
                        <div class="axis-description">Â∑¶„Å´ÂÇæ„Åë„Çã ‚Üê ‚Üí Âè≥„Å´ÂÇæ„Åë„Çã</div>
                    </div>

                    <div class="axis-item axis-y">
                        <div class="axis-header">
                            <div class="axis-label">
                                <div class="axis-icon">Y</div>
                                <span>ÂâçÂæå„ÅÆÂÇæ„Åç</span>
                            </div>
                            <div class="axis-value" id="yValue">0.00</div>
                        </div>
                        <div class="progress-container">
                            <div id="yProgress" class="progress-bar"></div>
                        </div>
                        <div class="axis-description">ÊâãÂâç„Å´ÂÇæ„Åë„Çã ‚Üê ‚Üí Â••„Å´ÂÇæ„Åë„Çã</div>
                    </div>

                    <div class="axis-item axis-z">
                        <div class="axis-header">
                            <div class="axis-label">
                                <div class="axis-icon">Z</div>
                                <span>‰∏ä‰∏ã„ÅÆÂãï„Åç</span>
                            </div>
                            <div class="axis-value" id="zValue">0.00</div>
                        </div>
                        <div class="progress-container">
                            <div id="zProgress" class="progress-bar"></div>
                        </div>
                        <div class="axis-description">‰∏ãÂêë„Åç ‚Üê ‚Üí ‰∏äÂêë„Åç</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="dowsingContent" class="tab-content active">
            <div id="dowsingData" class="sensor-data dowsing-container">
                <div class="pendulum-container">
                    <div class="dowsing-chart">
                        <div class="chart-circle">
                            <div class="chart-center"></div>
                        </div>
                    </div>

                    <div class="pendulum-anchor"></div>
                    <div id="pendulumChain" class="pendulum-chain">
                        <div class="pendulum-weight"></div>
                    </div>
                    <div id="pendulumShadow" class="pendulum-shadow"></div>
                </div>
            </div>

            <div class="detection-meter">
                <div class="meter-label">Êé¢Áü•„É¨„Éô„É´</div>
                <div class="meter-container">
                    <div id="meterFill" class="meter-fill"></div>
                    <div id="meterText" class="meter-text">0%</div>
                </div>
            </div>

            <div id="detectionStatus" class="detection-status none">
                ‰Ωï„ÇÇÊ§úÂá∫„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì
            </div>
        </div>
    </div>

    <div id="topDownContent" class="tab-content">
        <div id="topDownData" class="sensor-data">
            <div class="top-down-visualizer" id="topDownVisualizer">
                <svg class="top-down-chain" id="topDownChain" width="300" height="300">
                    <line id="topDownLine" x1="150" y1="150" x2="150" y2="150" stroke="#999" stroke-width="2"
                        opacity="0.7" />
                </svg>
                <div id="topDownBubble" class="top-down-bubble"></div>
            </div>
            <div class="info">
                üí° „Éö„É≥„Éá„É•„É©„É†„ÅÆÂãï„Åç„ÇíÁúü‰∏ä„Åã„ÇâË¶ã„ÅüÂõ≥„Åß„Åô„ÄÇ<br>
                Êè∫„Çå„ÅÆÊñπÂêë„Å®Â§ß„Åç„Åï„ÅåÂàÜ„Åã„Çä„Åæ„Åô„ÄÇ
            </div>
        </div>
    </div>


    <div class="info">
        üí° „Éá„Éê„Ç§„Çπ„ÇíÊßò„ÄÖ„Å™ÊñπÂêë„Å´Âãï„Åã„Åó„Å¶„Åø„Å¶„Åè„Å†„Åï„ÅÑ<br>
        Êõ¥Êñ∞È†ªÂ∫¶: 100ms
    </div>
    </div>

    <script>
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let debugLog = [];
        let isListening = false;
        let debugVisible = false;
        let currentTab = 'dowsing'; // „Éá„Éï„Ç©„É´„Éà„Çí„ÉÄ„Ç¶„Ç∏„É≥„Ç∞„Å´Â§âÊõ¥

        // Âä†ÈÄüÂ∫¶„Éá„Éº„Çø„ÅÆÂ±•Ê≠¥Ôºà„ÉÄ„Ç¶„Ç∏„É≥„Ç∞Áî®Ôºâ
        let linearAccelerationHistory = []; // Á∑öÂΩ¢Âä†ÈÄüÂ∫¶„ÅÆÂ±•Ê≠¥„Çí‰øùÂ≠ò
        let detectionLevel = 0;

        // ÊÑüÂ∫¶Ë®≠ÂÆö
        let sensitivity = 2.0;
        let tiltSensitivity = 1.0;

        // „Éö„É≥„Éá„É•„É©„É†„ÅÆÁâ©ÁêÜÁä∂ÊÖã
        let pendulumAngleX = 0;   // XËª∏Âë®„Çä„ÅÆËßíÂ∫¶ (deg)
        let pendulumAngleY = 0;   // YËª∏Âë®„Çä„ÅÆËßíÂ∫¶ (deg)
        let pendulumAngleZ = 0;   // ZËª∏Âë®„Çä„ÅÆËßíÂ∫¶ÔºàÊçª„ÇäÔºâ(deg)
        let pendulumVelocityX = 0;  // XËª∏Âë®„Çä„ÅÆËßíÈÄüÂ∫¶
        let pendulumVelocityY = 0;  // YËª∏Âë®„Çä„ÅÆËßíÈÄüÂ∫¶
        let pendulumVelocityZ = 0;  // ZËª∏Âë®„Çä„ÅÆËßíÈÄüÂ∫¶
        let pendulumForceX = 0;     // XËª∏ÊñπÂêë„ÅÆÂ§ñÂäõ
        let pendulumForceY = 0;     // YËª∏ÊñπÂêë„ÅÆÂ§ñÂäõ
        let pendulumForceZ = 0;     // ZËª∏ÊñπÂêë„ÅÆÂ§ñÂäõ

        // Âä†ÈÄüÂ∫¶„Åã„ÇâÈáçÂäõ„ÇíÂàÜÈõ¢„Åô„Çã„Åü„ÇÅ„ÅÆÂ§âÊï∞
        let gravity = { x: 0, y: 0, z: 0 };
        const LPF_ALPHA = 0.8; // „É≠„Éº„Éë„Çπ„Éï„Ç£„É´„Çø„ÅÆ‰øÇÊï∞ÔºàÂ§ß„Åç„ÅÑ„Åª„Å©Êªë„Çâ„ÅãÔºâ

        // Ê∏õË°∞ÊåØÂãï„É¢„Éá„É´ (F = -kx - cv) „Å´Âü∫„Å•„ÅèÂÆöÊï∞
        const SPRING_CONSTANT = 0.02; // Âæ©ÂÖÉÂäõ‰øÇÊï∞ (k) - ÊåØ„ÇäÂ≠ê„Çí‰∏≠Â§Æ„Å´Êàª„ÅôÂäõ
        const BASE_DAMPING = 0.98;   // Âü∫Êú¨Ê∏õË°∞‰øÇÊï∞ (c) - Âãï„Åç„ÇíÊ≠¢„ÇÅ„ÇãÂäõÔºàÁ©∫Ê∞óÊäµÊäó„Å™„Å©Ôºâ
        const BASE_MAX_ANGLE = 60;    // Âü∫Êú¨ÊúÄÂ§ßÊåØ„ÇåËßí (deg)

        // ÈùôÊ≠¢Áä∂ÊÖã„ÅÆÊ§úÂá∫„Å®‰∏≠ÂøÉ„Å∏„ÅÆÂºïÂäõ„Å´Èñ¢„Åô„ÇãÂÆöÊï∞
        let stillnessCounter = 0;
        const STILLNESS_THRESHOLD = 15; // „Åì„ÅÆ„Éï„É¨„Éº„É†Êï∞‰ª•‰∏ä„ÄÅÂãï„Åç„ÅåÂ∞ë„Å™„Åë„Çå„Å∞ÈùôÊ≠¢„Å®„Åø„Å™„Åô
        const MOVEMENT_THRESHOLD = 0.05; // „Åì„ÅÆËßíÈÄüÂ∫¶‰ª•‰∏ã„Çí„ÄåÂãï„Åç„ÅåÂ∞ë„Å™„ÅÑ„Äç„Å®„Åø„Å™„Åô
        const CENTER_PULL_FORCE = 0.005; // ‰∏≠ÂøÉ„Å´Âºï„ÅçÂØÑ„Åõ„ÇãÂäõ„ÅÆ‰øÇÊï∞

        // „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„ÇíÁîªÈù¢„Å´Ë°®Á§∫
        function log(message) {
            const now = new Date().toTimeString().split(' ')[0];
            const logMessage = `[${now}] ${message}`;
            debugLog.push(logMessage);
            if (debugLog.length > 10) {
                debugLog.shift();
            }
            document.getElementById('debugInfo').textContent = debugLog.join('\n');
            console.log(logMessage);
        }

        // „Éá„Éê„ÉÉ„Ç∞Ë°®Á§∫Âàá„ÇäÊõø„Åà
        document.getElementById('debugToggle').addEventListener('click', function () {
            debugVisible = !debugVisible;
            document.getElementById('debugInfo').classList.toggle('active', debugVisible);
            this.textContent = debugVisible ? '‚úñÔ∏è' : 'üîß';
        });

        // ÊÑüÂ∫¶„Çπ„É©„Ç§„ÉÄ„Éº„ÅÆ„Ç§„Éô„É≥„Éà
        document.getElementById('sensitivitySlider').addEventListener('input', function (e) {
            sensitivity = parseFloat(e.target.value);
            tiltSensitivity = sensitivity / 2;
            document.getElementById('sensitivityValue').textContent = 'x' + sensitivity.toFixed(1);
            log(`ÊÑüÂ∫¶„Çí${sensitivity.toFixed(1)}ÂÄç„Å´Â§âÊõ¥`);
        });

        // „Çø„ÉñÂàá„ÇäÊõø„Åà
        function switchTab(tabName) {
            currentTab = tabName;
            document.querySelectorAll('.tab').forEach(tab => tab.classList.toggle('active', tab.dataset.tab === tabName));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + 'Content').classList.add('active');
            log(`„Çø„Éñ„Çí${tabName}„Å´Âàá„ÇäÊõø„Åà„Åæ„Åó„Åü`);
        }

        document.querySelectorAll('.tab').forEach(tab => tab.addEventListener('click', () => switchTab(tab.dataset.tab)));

        // „Çπ„ÉÜ„Éº„Çø„ÇπÊõ¥Êñ∞
        function updateStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = 'status ' + type;
            log(`„Çπ„ÉÜ„Éº„Çø„Çπ: ${message} (${type})`);
        }

        // Áí∞Â¢ÉÊÉÖÂ†±„ÇíË®òÈå≤
        function logEnvironment() {
            log('=== Áí∞Â¢ÉÊÉÖÂ†± ===');
            log('UA: ' + navigator.userAgent.substring(0, 50) + '...');
            log('DeviceMotionEvent: ' + ('DeviceMotionEvent' in window ? '„ÅÇ„Çä' : '„Å™„Åó'));
            if (window.DeviceMotionEvent && window.DeviceMotionEvent.requestPermission) {
                log('requestPermission: „ÅÇ„ÇäÔºàiOS 13+Ôºâ');
            }
        }

        // === ÂÇæ„Åç„Çª„É≥„Çµ„ÉºÈñ¢ÈÄ£ ===
        function updateProgressBar(elementId, value, max = 10) {
            const progress = document.getElementById(elementId);
            if (!progress) return;
            const percentage = Math.min(Math.abs(value) / max * 50, 50);
            progress.style.width = percentage + '%';
            progress.style.transform = value >= 0 ? 'translateX(0)' : 'translateX(-100%)';
        }

        function update3DDevice(x, y) {
            const device = document.getElementById('device3d');
            if (!device) return;
            const rotateX = -y * 3 * tiltSensitivity;
            const rotateY = x * 3 * tiltSensitivity;
            device.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
        }

        function updateTiltBubble(x, y) {
            const bubble = document.getElementById('tiltBubble');
            if (!bubble) return;
            const maxOffset = 55;
            const offsetX = (x / 10) * maxOffset * tiltSensitivity;
            const offsetY = (y / 10) * maxOffset * tiltSensitivity;
            bubble.style.transform = `translate(calc(-50% + ${offsetX}px), calc(-50% + ${offsetY}px))`;
        }

        // === „ÉÄ„Ç¶„Ç∏„É≥„Ç∞Èñ¢ÈÄ£ ===
        /**
         * @description Á∑öÂΩ¢Âä†ÈÄüÂ∫¶ÔºàÈáçÂäõ„ÇíÈô§„ÅÑ„ÅüÂãï„ÅçÔºâ„ÅÆÂ§âÂåñÈáè„ÇíË®àÁÆó„Åô„Çã
         * @param {object} linearAccel - {x, y, z} „ÅÆÁ∑öÂΩ¢Âä†ÈÄüÂ∫¶„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà
         * @returns {number} - Âçò‰ΩçÊôÇÈñì„ÅÇ„Åü„Çä„ÅÆÂä†ÈÄüÂ∫¶Â§âÂåñ„ÅÆÂ§ß„Åç„Åï
         */
        function calculateMotionMagnitude(linearAccel) {
            linearAccelerationHistory.push({ ...linearAccel, time: Date.now() });
            const timeLimit = Date.now() - 500;
            linearAccelerationHistory = linearAccelerationHistory.filter(data => data.time > timeLimit);
            if (linearAccelerationHistory.length < 2) return 0;

            let totalChange = 0;
            for (let i = 1; i < linearAccelerationHistory.length; i++) {
                const prev = linearAccelerationHistory[i - 1];
                const curr = linearAccelerationHistory[i];
                const deltaX = curr.x - prev.x;
                const deltaY = curr.y - prev.y;
                const deltaZ = curr.z - prev.z;
                totalChange += Math.sqrt(deltaX * deltaX + deltaY * deltaY + deltaZ * deltaZ);
            }
            return totalChange / (linearAccelerationHistory.length - 1);
        }


        /**
         * Áâ©ÁêÜ„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„ÇíÊõ¥Êñ∞ (60fps„ÅßÂëº„Å≥Âá∫„Åï„Çå„Çã)
         * ÈùôÊ≠¢Áä∂ÊÖã„ÇíÊ§úÂá∫„Åó„ÄÅ‰∏≠ÂøÉ„Å∏„ÅÆÂèéÊùü„Çí‰øÉ„Åô„É≠„Ç∏„ÉÉ„ÇØ„ÇíÂê´„ÇÄ
         */
        function updatePendulumPhysics() {
            const dt = 1.0; // ÊôÇÈñì„Çπ„ÉÜ„ÉÉ„Éó„ÅØ1„Å®„Åó„Å¶„ÄÅ‰øÇÊï∞ÂÅ¥„ÅßË™øÊï¥

            // ÊÑüÂ∫¶„Å´Âøú„Åò„Å¶„Éë„É©„É°„Éº„Çø„ÇíË™øÊï¥
            const DAMPING = BASE_DAMPING - (sensitivity - 2) * 0.001; // ÊÑüÂ∫¶„ÅåÈ´ò„ÅÑ„Åª„Å©Ê∏õË°∞„ÅåÂº±„ÅÑ
            const MAX_ANGLE = BASE_MAX_ANGLE + (sensitivity - 2) * 1.5; // ÊÑüÂ∫¶„ÅåÈ´ò„ÅÑ„Åª„Å©Â§ß„Åç„ÅèÊè∫„Çå„Çã

            // ÁèæÂú®„ÅÆËßíÈÄüÂ∫¶„ÅÆÁµ∂ÂØæÂÄ§„ÅÆÂêàË®à„ÅßÂãï„Åç„ÅÆÊúâÁÑ°„ÇíÂà§ÂÆö
            const currentSpeed = Math.abs(pendulumVelocityX) + Math.abs(pendulumVelocityY);

            if (currentSpeed < MOVEMENT_THRESHOLD) {
                stillnessCounter++;
                // ‰∏ÄÂÆöÊôÇÈñì„ÄÅÂãï„Åç„ÅåÂ∞ë„Å™„ÅÑÁä∂ÊÖã„ÅåÁ∂ö„ÅÑ„Åü„Çâ„ÄÅ‰∏≠ÂøÉ„Å´Âºï„ÅçÂØÑ„Åõ„Çã
                if (stillnessCounter > STILLNESS_THRESHOLD) {
                    pendulumForceX -= pendulumAngleX * CENTER_PULL_FORCE;
                    pendulumForceY -= pendulumAngleY * CENTER_PULL_FORCE;
                    pendulumForceZ -= pendulumAngleZ * CENTER_PULL_FORCE * 0.5; // Êçª„Çä„ÅØÂº±„ÇÅ
                }
            } else {
                stillnessCounter = 0; // Âãï„Åç„Åå„ÅÇ„Çå„Å∞ÈùôÊ≠¢„Ç´„Ç¶„É≥„Çø„Éº„Çí„É™„Çª„ÉÉ„Éà
            }

            // ÊÑüÂ∫¶„Å´Âøú„Åò„Å¶Âæ©ÂÖÉÂäõ„ÇíË™øÊï¥ÔºàÈ´òÊÑüÂ∫¶„Åª„Å©Âº±„ÅèÔºâ
            const adjustedSpringConstant = SPRING_CONSTANT / (1 + (sensitivity - 2) * 0.05);

            // --- XËª∏ÊñπÂêë„ÅÆÈÅãÂãï (F = -kx - cv) ---
            const restoringForceX = -adjustedSpringConstant * pendulumAngleX;
            const totalForceX = pendulumForceX + restoringForceX;
            pendulumVelocityX = (pendulumVelocityX + totalForceX * dt) * DAMPING;
            pendulumAngleX += pendulumVelocityX * dt;

            // --- YËª∏ÊñπÂêë„ÅÆÈÅãÂãï ---
            const restoringForceY = -adjustedSpringConstant * pendulumAngleY;
            const totalForceY = pendulumForceY + restoringForceY;
            pendulumVelocityY = (pendulumVelocityY + totalForceY * dt) * DAMPING;
            pendulumAngleY += pendulumVelocityY * dt;

            // --- ZËª∏(Êçª„Çä)ÊñπÂêë„ÅÆÈÅãÂãï ---
            const restoringForceZ = -adjustedSpringConstant * 0.5 * pendulumAngleZ;
            const totalForceZ = pendulumForceZ + restoringForceZ;
            pendulumVelocityZ = (pendulumVelocityZ + totalForceZ * dt) * DAMPING;
            pendulumAngleZ += pendulumVelocityZ * dt;

            // ËßíÂ∫¶„ÇíÂà∂Èôê
            const totalAngle = Math.sqrt(pendulumAngleX * pendulumAngleX + pendulumAngleY * pendulumAngleY);
            if (totalAngle > MAX_ANGLE) {
                const scale = MAX_ANGLE / totalAngle;
                pendulumAngleX *= scale;
                pendulumAngleY *= scale;
            }
            pendulumAngleZ = Math.max(-90, Math.min(90, pendulumAngleZ)); // Êçª„ÇäËßíÂ∫¶„ÇíÂà∂Èôê

            // Â§ñÂäõ„ÇíÂæê„ÄÖ„Å´Ê∏õË°∞„Åï„Åõ„Çã
            pendulumForceX *= 0.9;
            pendulumForceY *= 0.9;
            pendulumForceZ *= 0.9;

            // Ë°®Á§∫„ÇíÊõ¥Êñ∞
            updatePendulumDisplay();
        }

        /**
         * Áâ©ÁêÜË®àÁÆó„ÅÆÁµêÊûú„ÇíDOM„Å´ÂèçÊò†„Åï„Åõ„Çã
         */
        function updatePendulumDisplay() {
            const pendulumChain = document.getElementById('pendulumChain');
            const pendulumShadow = document.getElementById('pendulumShadow');
            if (!pendulumChain || !pendulumShadow) return;

            // 3Ëª∏„ÅÆÂõûËª¢„ÇíÈÅ©Áî®ÔºàZËª∏„ÅÆÊçª„Çä„ÇíËøΩÂä†Ôºâ
            pendulumChain.style.transform = `rotateX(${pendulumAngleY}deg) rotateY(${-pendulumAngleX}deg) rotateZ(${pendulumAngleZ}deg)`;

            // ÂΩ±„ÅÆ‰ΩçÁΩÆ„ÇíË®àÁÆó
            const chainLength = 220;
            const shadowOffsetX = chainLength * Math.sin(-pendulumAngleX * Math.PI / 180);
            const shadowOffsetY = chainLength * Math.sin(pendulumAngleY * Math.PI / 180) * Math.sin(60 * Math.PI / 180);

            // ÂΩ±„ÅÆ„Çπ„Ç±„Éº„É´„Å®‰∏çÈÄèÊòéÂ∫¶„ÇíË™øÊï¥
            const shadowDist = Math.sqrt(shadowOffsetX * shadowOffsetX + shadowOffsetY * shadowOffsetY);
            const maxShadowDist = 80;
            const shadowScale = Math.max(0.4, 1 - shadowDist / (maxShadowDist * 2));
            const shadowOpacity = Math.max(0.1, 0.5 - shadowDist / maxShadowDist);

            pendulumShadow.style.transform = `translateX(calc(-50% + ${shadowOffsetX}px)) translateY(${shadowOffsetY}px) rotateX(90deg) scale(${shadowScale})`;
            pendulumShadow.style.opacity = shadowOpacity;

            // „ÉÅ„É£„Éº„Éà„Éè„Ç§„É©„Ç§„Éà
            updateChartHighlight(pendulumAngleX, pendulumAngleY);

            // Áúü‰∏äË¶ñÁÇπ„ÇíÊõ¥Êñ∞
            updateTopDownView(pendulumAngleX, pendulumAngleY);
        }

        /**
         * „Éö„É≥„Éá„É•„É©„É†„Å´Â§ñÂäõ„ÇíÂä†„Åà„Çã
         * ÁèæÂú®„ÅÆ„Çø„ÉñÔºà„É¢„Éº„ÉâÔºâ„Å´Âøú„Åò„Å¶„ÄÅÂä†ÈÄüÂ∫¶„Çª„É≥„Çµ„Éº„ÅÆÂÖ•Âäõ„ÇíÂäõ„ÅÆ„Éû„ÉÉ„Éî„É≥„Ç∞„Å´Â§âÊèõ„Åô„Çã
         */
        function updatePendulum(linearAccel) {
            // ÊÑüÂ∫¶„Å´Âøú„Åò„Å¶Â§ñÂäõ„ÅÆ„Çπ„Ç±„Éº„É´„ÇíÈùûÁ∑öÂΩ¢„Å´Ë™øÊï¥
            const forceScale = 0.1 * Math.pow(sensitivity / 2, 1.2);

            if (currentTab === 'dowsing') {
                // „Äå„ÉÄ„Ç¶„Ç∏„É≥„Ç∞„Äç„É¢„Éº„ÉâÔºö„Çπ„Éû„Éõ„ÅØÂú∞Èù¢„Å®ÂûÇÁõ¥
                // YËª∏„ÅÆÂä†ÈÄüÂ∫¶Ôºà‰∏ä‰∏ãÔºâ„Çí„ÄÅ„Éö„É≥„Éá„É•„É©„É†„ÅÆXËª∏„ÅÆÂäõÔºàÂ∑¶Âè≥Ôºâ„Å´
                pendulumForceX += linearAccel.y * forceScale;
                // ZËª∏„ÅÆÂä†ÈÄüÂ∫¶ÔºàÂâçÂæåÔºâ„Çí„ÄÅ„Éö„É≥„Éá„É•„É©„É†„ÅÆYËª∏„ÅÆÂäõÔºàÂâçÂæåÔºâ„Å´
                pendulumForceY += linearAccel.z * forceScale;
                // XËª∏„ÅÆÂä†ÈÄüÂ∫¶ÔºàÂ∑¶Âè≥Ôºâ„Çí„ÄÅ„Éö„É≥„Éá„É•„É©„É†„ÅÆZËª∏„ÅÆÂäõÔºàÊçª„ÇäÔºâ„Å´
                pendulumForceZ += linearAccel.x * forceScale * 0.5;
            } else if (currentTab === 'topDown') {
                // „ÄåÁúü‰∏ä„Åã„ÇâË¶ã„Çã„Äç„É¢„Éº„ÉâÔºö„Çπ„Éû„Éõ„ÅØÂú∞Èù¢„Å®Ê∞¥Âπ≥
                // XËª∏„ÅÆÂä†ÈÄüÂ∫¶ÔºàÂ∑¶Âè≥Ôºâ„Çí„ÄÅ„Éö„É≥„Éá„É•„É©„É†„ÅÆXËª∏„ÅÆÂäõÔºàÂ∑¶Âè≥Ôºâ„Å´
                pendulumForceX -= linearAccel.x * forceScale;
                // YËª∏„ÅÆÂä†ÈÄüÂ∫¶ÔºàÂâçÂæåÔºâ„Çí„ÄÅ„Éö„É≥„Éá„É•„É©„É†„ÅÆYËª∏„ÅÆÂäõÔºàÂâçÂæåÔºâ„Å´
                pendulumForceY += linearAccel.y * forceScale;
                // ZËª∏„ÅÆÂä†ÈÄüÂ∫¶Ôºà‰∏ä‰∏ãÔºâ„Çí„ÄÅ„Éö„É≥„Éá„É•„É©„É†„ÅÆZËª∏„ÅÆÂäõÔºàÊçª„ÇäÔºâ„Å´
                pendulumForceZ += linearAccel.z * forceScale * 0.5;
            }
        }

        function updateChartHighlight(swingX, swingY) {
            const distance = Math.sqrt(swingX * swingX + swingY * swingY);

            if (distance > 15) {
                updateDetectionStatus('„Éö„É≥„Éá„É•„É©„É†„ÅåÂãï„ÅÑ„Å¶„ÅÑ„Åæ„Åô', 'strong');
            } else if (stillnessCounter < STILLNESS_THRESHOLD) {
                updateDetectionStatus('Âãï„Åç„ÇíÊ§úÂá∫‰∏≠...', 'weak');
            } else {
                updateDetectionStatus('‰∏≠ÂøÉ„Å´ÂèéÊùü„Åó„Åæ„Åó„Åü', 'none');
            }
        }

        function updateDetectionLevel(changeLevel) {
            detectionLevel = Math.min(changeLevel * 20 * sensitivity, 100);
            const meterFill = document.getElementById('meterFill');
            const meterText = document.getElementById('meterText');
            if (!meterFill || !meterText) return;
            meterFill.style.width = detectionLevel + '%';
            meterText.textContent = Math.round(detectionLevel) + '%';
        }

        function updateDetectionStatus(text, className) {
            const statusDiv = document.getElementById('detectionStatus');
            if (statusDiv) {
                statusDiv.textContent = text;
                statusDiv.className = 'detection-status ' + className;
            }
        }

        /**
         * Áúü‰∏äË¶ñÁÇπ„ÅÆ„Éê„Éñ„É´„ÅÆ‰ΩçÁΩÆ„ÇíÊõ¥Êñ∞„Åô„Çã
         */
        function updateTopDownView(angleX, angleY) {
            const bubble = document.getElementById('topDownBubble');
            const line = document.getElementById('topDownLine');
            if (!bubble || !line) return;
            // Ë°®Á§∫„Ç®„É™„Ç¢„ÅÆÂçäÂæÑ - „Éê„Éñ„É´„ÅÆÂçäÂæÑ = 150 - 15 = 135
            const maxOffset = 125;
            // ÊåØ„Çå„ÅÆËßíÂ∫¶„Çí-1 ~ 1„ÅÆÁØÑÂõ≤„Å´Ê≠£Ë¶èÂåñ„Åó„ÄÅ„Ç™„Éï„Çª„ÉÉ„Éà„ÇíË®àÁÆó
            const offsetX = (angleX / BASE_MAX_ANGLE) * maxOffset;
            const offsetY = (angleY / BASE_MAX_ANGLE) * maxOffset;
            bubble.style.transform = `translate(calc(-50% + ${offsetX}px), calc(-50% + ${offsetY}px))`;

            // SVG„ÅÆÁ∑ö„ÅÆÁµÇÁÇπ„ÇíÊõ¥Êñ∞Ôºà‰∏≠ÂøÉ„ÅØ150,150Ôºâ
            const centerX = 150;
            const centerY = 150;
            line.setAttribute('x2', centerX + offsetX);
            line.setAttribute('y2', centerY + offsetY);
        }

        /**
         * „Çª„É≥„Çµ„Éº„Éá„Éº„ÇøÂá¶ÁêÜ„ÅÆ‰∏≠Ê†∏
         */
        function updateSensorData(x, y, z) {
            // „É≠„Éº„Éë„Çπ„Éï„Ç£„É´„Çø„ÅßÈáçÂäõ„Éô„ÇØ„Éà„É´„ÇíÊé®ÂÆö
            gravity.x = LPF_ALPHA * gravity.x + (1 - LPF_ALPHA) * x;
            gravity.y = LPF_ALPHA * gravity.y + (1 - LPF_ALPHA) * y;
            gravity.z = LPF_ALPHA * gravity.z + (1 - LPF_ALPHA) * z;

            // „Çª„É≥„Çµ„Éº„ÅÆÂÄ§„Åã„ÇâÈáçÂäõ„ÇíÂºï„ÅÑ„Å¶„ÄÅÂãï„Åç„Å´„Çà„ÇãÁ∑öÂΩ¢Âä†ÈÄüÂ∫¶„ÇíÁÆóÂá∫
            const linearAcceleration = {
                x: x - gravity.x,
                y: y - gravity.y,
                z: z - gravity.z
            };

            if (currentTab === 'tilt') {
                document.getElementById('xValue').textContent = x.toFixed(2);
                document.getElementById('yValue').textContent = y.toFixed(2);
                document.getElementById('zValue').textContent = z.toFixed(2);
                updateProgressBar('xProgress', x);
                updateProgressBar('yProgress', y);
                updateProgressBar('zProgress', z - 9.8);
                update3DDevice(x, y);
                updateTiltBubble(x, y);
            } else if (currentTab === 'dowsing' || currentTab === 'topDown') {
                // „ÉÄ„Ç¶„Ç∏„É≥„Ç∞„Å®Áúü‰∏äË¶ñÁÇπ„ÅØÂêå„ÅòÁâ©ÁêÜ„É¢„Éá„É´„ÇíÂÖ±Êúâ„Åô„Çã„Åå„ÄÅÂÖ•Âäõ„ÅÆ„Éû„ÉÉ„Éî„É≥„Ç∞„ÅåÁï∞„Å™„Çã
                updatePendulum(linearAcceleration);
                const motionMagnitude = calculateMotionMagnitude(linearAcceleration);
                updateDetectionLevel(motionMagnitude);
            }
        }

        // „Çª„É≥„Çµ„ÉºÈñãÂßã
        async function startSensor() {
            log('startSensorÈñ¢Êï∞„ÅåÂëº„Å∞„Çå„Åæ„Åó„Åü');
            const button = document.getElementById('startButton');
            button.disabled = true;

            try {
                if (window.DeviceMotionEvent && typeof window.DeviceMotionEvent.requestPermission === 'function') {
                    log('iOS 13+„ÅÆÊ®©Èôê„Çí„É™„ÇØ„Ç®„Çπ„Éà‰∏≠...');
                    updateStatus('„Çª„É≥„Çµ„Éº„ÅÆÊ®©Èôê„ÇíÁ¢∫Ë™ç‰∏≠...', 'waiting');
                    const permission = await window.DeviceMotionEvent.requestPermission();
                    if (permission !== 'granted') throw new Error('Ê®©Èôê„ÅåÊãíÂê¶„Åï„Çå„Åæ„Åó„Åü');
                }

                if (!isListening) {
                    log('devicemotion„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíË®≠ÂÆö‰∏≠...');
                    let eventCount = 0;
                    let lastUpdate = 0;

                    window.addEventListener('devicemotion', (event) => {
                        eventCount++;
                        if (eventCount === 1) {
                            log('ÊúÄÂàù„ÅÆ„Ç§„Éô„É≥„Éà„ÇíÂèó‰ø°ÔºÅ');
                            document.querySelectorAll('.sensor-data').forEach(el => el.classList.add('active'));
                            updateStatus('„Çª„É≥„Çµ„ÉºÂãï‰Ωú‰∏≠ üéØ', 'success');
                        }

                        const now = Date.now();
                        if (now - lastUpdate < 100) return;
                        lastUpdate = now;

                        if (event.accelerationIncludingGravity) {
                            const acc = event.accelerationIncludingGravity;
                            updateSensorData(acc.x || 0, acc.y || 0, acc.z || 0);
                        }
                    });

                    isListening = true;
                    log('„É™„Çπ„Éä„ÉºË®≠ÂÆöÂÆå‰∫Ü');
                    setTimeout(() => {
                        if (eventCount === 0) {
                            log('Ë≠¶Âëä: 3ÁßíÁµå„Å£„Å¶„ÇÇ„Ç§„Éô„É≥„Éà„ÅåÊù•„Åæ„Åõ„Çì');
                            updateStatus('„Çª„É≥„Çµ„Éº„ÅåÂèçÂøú„Åó„Åæ„Åõ„Çì„ÄÇ„Éá„Éê„Ç§„Çπ„ÇíÂãï„Åã„Åó„Å¶„Åø„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                        }
                    }, 3000);
                }
                button.textContent = '‚ú® „Çª„É≥„Çµ„ÉºÂãï‰Ωú‰∏≠';
                updateStatus('„Çª„É≥„Çµ„Éº„ÇíËµ∑Âãï„Åó„Åæ„Åó„Åü', 'success');
            } catch (error) {
                log('„Ç®„É©„Éº: ' + error.message);
                updateStatus('„Ç®„É©„Éº: ' + error.message, 'error');
                button.disabled = false;
            }
        }

        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', () => {
            log('„Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÂÆå‰∫Ü');
            logEnvironment();
            const button = document.getElementById('startButton');

            if (!window.DeviceMotionEvent) {
                log('„Ç®„É©„Éº: DeviceMotionEvent„Åå„Çµ„Éù„Éº„Éà„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì');
                updateStatus('„Åì„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØÂä†ÈÄüÂ∫¶„Çª„É≥„Çµ„Éº„Å´ÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì', 'error');
                button.disabled = true;
                return;
            }

            button.addEventListener('click', () => {
                log('„Éú„Çø„É≥„Åå„ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„Åü');
                startSensor();
            });

            // Áâ©ÁêÜ„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„ÅÆ„É´„Éº„Éó„ÇíÈñãÂßã
            setInterval(updatePendulumPhysics, 1000 / 60);

            log('ÂàùÊúüÂåñÂÆå‰∫Ü');
        });
    </script>
</body>

</html>